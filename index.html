<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>پنل کاربری SODmAX CityVerse - نسخه کامل (با Supabase)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- اضافه کردن کتابخانه Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary: #0066FF;
            --primary-dark: #0052CC;
            --primary-light: #3395FF;
            --secondary: #00D4AA;
            --accent: #FF6B35;
            --premium: #FFD700;
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;
            
            --bg-primary: #0a0f1c;
            --bg-secondary: #131a2d;
            --bg-surface: rgba(25, 35, 60, 0.9);
            --bg-card: rgba(30, 41, 59, 0.8);
            --bg-overlay: rgba(10, 15, 28, 0.95);
            
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --text-muted: #6b7280;
            
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
            --shadow-primary: 0 0 20px rgba(0, 102, 255, 0.4);
            
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, #06b6d4 100%);
            --gradient-accent: linear-gradient(135deg, var(--accent) 0%, #f97316 100%);
            --gradient-premium: linear-gradient(135deg, var(--premium) 0%, #fbbf24 100%);
            --gradient-success: linear-gradient(135deg, var(--success) 0%, #34d399 100%);
            --gradient-dark: linear-gradient(135deg, var(--bg-primary) 0%, #1a2332 100%);
            --gradient-glass: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            
            --transition-fast: 0.2s ease;
            --transition-base: 0.3s ease;
            --transition-bounce: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
            
            --space-xs: 6px;
            --space-sm: 12px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 40px;
            
            --z-header: 100;
            --z-menu: 200;
            --z-modal: 300;
            --z-toast: 400;
            --z-auth: 500;
            --z-effect: 10000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 15px;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* پس‌زمینه */
        .mobile-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-dark);
            z-index: -2;
        }

        /* استایل‌های مشترک */
        .hidden {
            display: none !important;
        }

        /* ==================== بخش احراز هویت ==================== */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-overlay);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-md);
            z-index: var(--z-auth);
            transition: opacity var(--transition-base);
        }

        .auth-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .auth-card {
            background: var(--bg-surface);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: var(--shadow-lg);
            animation: slideUpAuth 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            overflow: hidden;
        }

        .auth-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        @keyframes slideUpAuth {
            from {
                transform: translateY(40px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .auth-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .auth-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .auth-logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            color: white;
            box-shadow: var(--shadow-primary);
        }

        .auth-logo-text {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .auth-logo-title {
            font-size: 20px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .auth-logo-subtitle {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .auth-title {
            font-size: 24px;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: var(--space-xs);
        }

        .auth-subtitle {
            font-size: 14px;
            color: var(--text-tertiary);
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: var(--space-xs);
        }

        .form-input {
            width: 100%;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            transition: all var(--transition-base);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }

        .form-input.error {
            border-color: var(--error);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }

        .form-error {
            font-size: 12px;
            color: var(--error);
            margin-top: var(--space-xs);
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            opacity: 0;
            transform: translateY(-5px);
            transition: all var(--transition-base);
        }

        .form-error.show {
            opacity: 1;
            transform: translateY(0);
        }

        .password-toggle {
            position: absolute;
            left: var(--space-md);
            top: 42px;
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            transition: color var(--transition-base);
        }

        .password-toggle:hover {
            color: var(--text-primary);
        }

        .auth-btn {
            width: 100%;
            padding: var(--space-md);
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--radius-lg);
            color: white;
            font-family: inherit;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            margin-top: var(--space-md);
        }

        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .auth-btn:active {
            transform: translateY(0);
        }

        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .auth-switch {
            text-align: center;
            margin-top: var(--space-lg);
            padding-top: var(--space-lg);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-switch-text {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        .auth-switch-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-weight: 700;
            cursor: pointer;
            margin-right: var(--space-xs);
            transition: color var(--transition-base);
        }

        .auth-switch-btn:hover {
            color: var(--primary-light);
        }

        .auth-terms {
            font-size: 11px;
            color: var(--text-tertiary);
            text-align: center;
            margin-top: var(--space-lg);
            line-height: 1.5;
        }

        .auth-terms a {
            color: var(--primary);
            text-decoration: none;
        }

        .auth-terms a:hover {
            text-decoration: underline;
        }

        /* ==================== بخش اصلی اپلیکیشن ==================== */
        .app-container {
            display: none;
        }

        .app-container.active {
            display: block;
            padding-bottom: 80px;
        }

        /* هدر موبایل */
        .mobile-header {
            background: var(--bg-surface);
            backdrop-filter: blur(20px);
            padding: var(--space-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            position: sticky;
            top: 0;
            z-index: var(--z-header);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-mobile {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .logo-icon-mobile {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 900;
            color: white;
            box-shadow: var(--shadow-primary);
        }

        .logo-text-mobile {
            display: flex;
            flex-direction: column;
        }

        .logo-title-mobile {
            font-size: 16px;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1.2;
        }

        .logo-subtitle-mobile {
            font-size: 10px;
            color: var(--text-tertiary);
        }

        /* دکمه‌های هدر */
        .header-actions-mobile {
            display: flex;
            gap: var(--space-sm);
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all var(--transition-fast);
            position: relative;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .notification-badge {
            position: absolute;
            top: -4px;
            left: -4px;
            background: var(--accent);
            color: white;
            font-size: 10px;
            font-weight: 900;
            width: 18px;
            height: 18px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--bg-surface);
        }

        /* منوی کشویی موبایل */
        .mobile-menu-overlay {
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            height: 100%;
            background: var(--bg-surface);
            backdrop-filter: blur(30px);
            z-index: var(--z-menu);
            transition: right var(--transition-bounce);
            padding: var(--space-xl) var(--space-lg);
            overflow-y: auto;
            border-left: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: var(--shadow-lg);
        }

        .mobile-menu-overlay.active {
            right: 0;
        }

        .menu-header-mobile {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-lg);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .user-avatar-mobile {
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            color: white;
            box-shadow: var(--shadow-primary);
        }

        .user-info-mobile h4 {
            font-size: 16px;
            font-weight: 900;
            margin-bottom: 4px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-info-mobile p {
            font-size: 12px;
            color: var(--text-tertiary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--secondary);
            border-radius: var(--radius-full);
            position: relative;
        }

        .status-dot::after {
            content: '';
            position: absolute;
            inset: -3px;
            background: var(--secondary);
            border-radius: inherit;
            opacity: 0.3;
            animation: pulse 2s infinite;
        }

        .mobile-nav {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
            margin-bottom: var(--space-xl);
        }

        .nav-group-mobile {
            margin-bottom: var(--space-lg);
        }

        .nav-group-title-mobile {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--space-md);
            padding: 0 var(--space-sm);
        }

        .nav-item-mobile {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            color: var(--text-secondary);
            text-decoration: none;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .nav-item-mobile::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-primary);
            transform: translateX(100%);
            transition: transform var(--transition-base);
        }

        .nav-item-mobile:hover,
        .nav-item-mobile.active {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            transform: translateX(-4px);
        }

        .nav-item-mobile:hover::before,
        .nav-item-mobile.active::before {
            transform: translateX(0);
        }

        .nav-icon-mobile {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .nav-label-mobile {
            font-size: 14px;
            font-weight: 600;
            flex: 1;
        }

        .nav-badge-mobile {
            background: var(--gradient-primary);
            color: white;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            font-size: 10px;
            font-weight: 700;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-stats-mobile {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-sm);
            margin-top: auto;
            padding-top: var(--space-xl);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
        }

        .menu-stat {
            text-align: center;
            padding: var(--space-sm);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
        }

        .stat-value-menu {
            font-size: 16px;
            font-weight: 900;
            color: var(--text-primary);
            line-height: 1;
            margin-bottom: 4px;
        }

        .stat-label-menu {
            font-size: 9px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* محتوای اصلی */
        .mobile-content {
            padding: var(--space-md);
            padding-top: 0;
        }

        /* بخش‌های محتوا */
        .content-section-mobile {
            display: none;
            animation: fadeInMobile 0.3s ease-out;
        }

        .content-section-mobile.active {
            display: block;
        }

        @keyframes fadeInMobile {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* کارت‌های موبایل */
        .mobile-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            border: 1px solid rgba(255, 255, 255, 0.15);
            margin-bottom: var(--space-lg);
            position: relative;
            overflow: hidden;
        }

        .mobile-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
        }

        .card-title-mobile {
            font-size: 18px;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: var(--space-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        /* ویجت‌های سریع موبایل */
        .quick-stats-mobile {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }

        .quick-stat {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-base);
        }

        .quick-stat:active {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .stat-main-mobile {
            font-size: 24px;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: 4px;
            line-height: 1;
        }

        .stat-label-mobile {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* مرکز استخراج موبایل */
        .miner-mobile-container {
            text-align: center;
            margin: var(--space-xl) 0;
        }

        .miner-3d-mobile {
            width: 200px;
            height: 200px;
            margin: 0 auto var(--space-lg);
            background: linear-gradient(145deg, 
                rgba(0, 102, 255, 0.15) 0%,
                rgba(30, 41, 59, 0.9) 50%,
                rgba(0, 102, 255, 0.05) 100%);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            border: 3px solid transparent;
            animation: 
                minerFloatMobile 6s ease-in-out infinite,
                minerGlowMobile 4s infinite alternate;
            box-shadow: 
                inset 0 0 40px rgba(0, 102, 255, 0.3),
                0 16px 40px rgba(0, 0, 0, 0.5),
                0 0 50px rgba(0, 102, 255, 0.2);
        }

        .miner-core-mobile {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .core-icon-mobile {
            font-size: 48px;
            margin-bottom: var(--space-md);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: 
                iconPulseMobile 2s infinite,
                iconRotateMobile 20s infinite linear;
        }

        .click-reward-mobile {
            font-size: 24px;
            font-weight: 900;
            color: var(--text-primary);
            text-shadow: 
                0 2px 8px rgba(0, 102, 255, 0.5),
                0 0 20px rgba(0, 102, 255, 0.8);
            margin-bottom: var(--space-xs);
        }

        .mining-controls-mobile {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }

        .mining-btn-mobile {
            padding: var(--space-md);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.15);
            background: var(--gradient-glass);
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-bounce);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }

        .mining-btn-mobile:active {
            transform: translateY(-4px);
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        /* مأموریت‌های موبایل */
        .mission-item-mobile {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: var(--space-sm);
            transition: all var(--transition-base);
        }

        .mission-item-mobile:active {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(4px);
        }

        .mission-header-mobile {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-sm);
        }

        .mission-name-mobile {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
            flex: 1;
        }

        .mission-reward-mobile {
            background: var(--gradient-secondary);
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
        }

        .progress-bar-mobile {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill-mobile {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width 1s ease;
            position: relative;
        }

        .progress-text-mobile {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: var(--text-tertiary);
        }

        /* پاداش‌های موبایل */
        .rewards-grid-mobile {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .reward-item-mobile {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-bounce);
        }

        .reward-item-mobile:active {
            transform: scale(0.95) rotate(5deg);
            border-color: var(--primary);
        }

        .reward-icon-mobile {
            font-size: 24px;
            margin-bottom: var(--space-sm);
        }

        .reward-amount-mobile {
            font-size: 16px;
            font-weight: 900;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .reward-type-mobile {
            font-size: 10px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* دکمه موبایل */
        .btn-mobile {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            border: none;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            width: 100%;
            font-family: inherit;
        }

        .btn-mobile-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-mobile-primary:active {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-mobile-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-mobile-secondary:active {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .btn-mobile-success {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: var(--shadow-md);
        }

        .btn-mobile-premium {
            background: var(--gradient-premium);
            color: #000;
            box-shadow: var(--shadow-md);
            font-weight: 800;
        }

        /* نوار پایین موبایل */
        .mobile-bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-surface);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            justify-content: space-around;
            padding: var(--space-sm) 0;
            z-index: var(--z-header);
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-tertiary);
            text-decoration: none;
            transition: all var(--transition-fast);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-md);
            min-width: 60px;
        }

        .bottom-nav-item.active,
        .bottom-nav-item:active {
            color: var(--primary);
            background: rgba(0, 102, 255, 0.1);
        }

        .bottom-nav-icon {
            font-size: 18px;
        }

        .bottom-nav-label {
            font-size: 10px;
            font-weight: 600;
        }

        /* مودال موبایل */
        .modal-mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            opacity: 0;
            transition: opacity var(--transition-base);
            padding: var(--space-md);
        }

        .modal-mobile-overlay.active {
            display: flex;
            opacity: 1;
        }

        .modal-mobile-content {
            background: var(--bg-surface);
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: translateY(40px) scale(0.9);
            transition: all var(--transition-bounce);
            position: relative;
        }

        .modal-mobile-overlay.active .modal-mobile-content {
            transform: translateY(0) scale(1);
        }

        .modal-header-mobile {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        .modal-title-mobile {
            font-size: 18px;
            font-weight: 900;
            color: var(--text-primary);
        }

        .close-modal-mobile {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-primary);
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .close-modal-mobile:active {
            background: var(--gradient-primary);
            transform: rotate(90deg);
        }

        /* توست موبایل */
        .toast-container-mobile {
            position: fixed;
            top: 80px;
            left: 0;
            right: 0;
            z-index: var(--z-toast);
            padding: 0 var(--space-md);
            pointer-events: none;
        }

        .toast-mobile {
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            padding: var(--space-md);
            border-left: 4px solid var(--primary);
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
            animation: slideDownMobile 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
            pointer-events: auto;
        }

        .toast-icon-mobile {
            width: 28px;
            height: 28px;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            flex-shrink: 0;
        }

        .toast-content-mobile {
            flex: 1;
        }

        .toast-title-mobile {
            font-size: 13px;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .toast-message-mobile {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* بهبود کیف پول برای موبایل */
        .wallet-balance-item {
            display: flex;
            align-items: center;
            padding: var(--space-md);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-sm);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all var(--transition-base);
        }
        
        .wallet-balance-item:active {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-4px);
        }
        
        .wallet-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-left: var(--space-md);
            flex-shrink: 0;
        }
        
        .wallet-info {
            flex: 1;
        }
        
        .wallet-amount {
            font-size: 20px;
            font-weight: 900;
            color: var(--text-primary);
            line-height: 1.2;
        }
        
        .wallet-currency {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }
        
        .wallet-actions {
            display: flex;
            gap: var(--space-xs);
            margin-top: var(--space-md);
        }
        
        .wallet-action-btn {
            flex: 1;
            padding: var(--space-sm);
            border-radius: var(--radius-md);
            border: none;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        /* تراکنش‌های بهبود یافته */
        .transaction-item {
            display: flex;
            align-items: center;
            padding: var(--space-sm);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-xs);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .transaction-item:active {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .transaction-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            margin-left: var(--space-sm);
            flex-shrink: 0;
        }
        
        .transaction-details {
            flex: 1;
            min-width: 0;
        }
        
        .transaction-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .transaction-date {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }
        
        .transaction-amount {
            font-size: 14px;
            font-weight: 900;
            text-align: left;
            padding-right: var(--space-sm);
            white-space: nowrap;
        }

        /* افکت ماینینگ */
        .mining-effect {
            position: fixed;
            color: var(--primary-light);
            font-weight: 900;
            font-size: 24px;
            pointer-events: none;
            z-index: var(--z-effect);
            text-shadow: 0 0 20px var(--primary);
            animation: miningFloat 1s ease-out forwards;
            transform-origin: center;
        }
        
        .mining-effect span {
            display: block;
            padding: 4px 12px;
            background: rgba(0, 102, 255, 0.2);
            border-radius: var(--radius-full);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 102, 255, 0.3);
        }
        
        /* انیمیشن‌های موبایل */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        @keyframes minerFloatMobile {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-15px) rotate(5deg);
            }
            50% {
                transform: translateY(0) rotate(0deg);
            }
            75% {
                transform: translateY(-15px) rotate(-5deg);
            }
        }

        @keyframes minerGlowMobile {
            0%, 100% {
                box-shadow: 
                    inset 0 0 40px rgba(0, 102, 255, 0.3),
                    0 16px 40px rgba(0, 0, 0, 0.5),
                    0 0 50px rgba(0, 102, 255, 0.2);
            }
            50% {
                box-shadow: 
                    inset 0 0 40px rgba(0, 102, 255, 0.4),
                    0 16px 40px rgba(0, 0, 0, 0.5),
                    0 0 80px rgba(0, 102, 255, 0.4);
            }
        }

        @keyframes iconPulseMobile {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        @keyframes iconRotateMobile {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes slideDownMobile {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes miningFloat {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -150px) scale(1.5);
                opacity: 0;
            }
        }

        /* بهبود برای تبلت */
        @media (min-width: 768px) {
            .mobile-menu-overlay {
                width: 300px;
            }
            
            .rewards-grid-mobile {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .mining-controls-mobile {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* اسکرول‌بار سفارشی */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
        }

        /* لودر */
        .loader-mobile {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: var(--space-xl);
        }

        .loader-mobile::after {
            content: '';
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
            border-radius: var(--radius-full);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* حالت افقی */
        @media (orientation: landscape) and (max-height: 600px) {
            .mobile-header {
                padding: var(--space-sm) var(--space-md);
            }
            
            .mobile-content {
                padding: var(--space-sm);
            }
            
            .mobile-card {
                padding: var(--space-md);
                margin-bottom: var(--space-md);
            }
            
            .miner-3d-mobile {
                width: 150px;
                height: 150px;
                margin: var(--space-sm) auto;
            }
        }

        /* سوئیچ */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .slider.round {
            border-radius: 34px;
        }
        
        .slider.round:before {
            border-radius: 50%;
        }
        
        /* ==================== اصلاحات چیدمان ==================== */
        /* اصلاح کیف پول چند ارزی - دکمه‌ها در یک خط */
        .wallet-actions-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }
        
        .wallet-action-row-btn {
            flex: 1;
            min-width: 110px;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        /* اصلاح بخش اشتراک‌گذاری در دعوت دوستان */
        .share-buttons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }
        
        .share-button {
            padding: 12px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .share-button:active {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        
        .share-button i {
            font-size: 20px;
        }
        
        /* بهبود responsive */
        @media (max-width: 380px) {
            .wallet-action-row-btn {
                min-width: 90px;
                font-size: 12px;
                padding: 10px;
            }
            
            .share-buttons-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .share-button {
                padding: 10px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- پس‌زمینه -->
    <div class="mobile-background"></div>
    
    <!-- ==================== بخش احراز هویت ==================== -->
    <div class="auth-container" id="authContainer">
        <!-- فرم ثبت‌نام -->
        <div class="auth-card" id="registerForm">
            <div class="auth-header">
                <div class="auth-logo">
                    <div class="auth-logo-icon">⚡</div>
                    <div class="auth-logo-text">
                        <div class="auth-logo-title">SODmAX</div>
                        <div class="auth-logo-subtitle">CityVerse Pro</div>
                    </div>
                </div>
                <h2 class="auth-title">ثبت‌نام در SODmAX</h2>
                <p class="auth-subtitle">حساب کاربری جدید ایجاد کنید</p>
            </div>
            
            <form class="auth-form" id="registerFormElement">
                <div class="form-group">
                    <label class="form-label" for="registerName">نام و نام خانوادگی</label>
                    <input type="text" id="registerName" class="form-input" placeholder="مثلاً: علی محمدی" required>
                    <div class="form-error" id="nameError">
                        <i class="fas fa-exclamation-circle"></i>
                        نام و نام خانوادگی الزامی است
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerPhone">شماره موبایل</label>
                    <input type="tel" id="registerPhone" class="form-input" placeholder="مثلاً: 09123456789" required>
                    <div class="form-error" id="phoneError">
                        <i class="fas fa-exclamation-circle"></i>
                        شماره موبایل معتبر وارد کنید
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerPassword">رمز عبور</label>
                    <input type="password" id="registerPassword" class="form-input" placeholder="حداقل ۶ کاراکتر" required>
                    <button type="button" class="password-toggle" id="toggleRegisterPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                    <div class="form-error" id="passwordError">
                        <i class="fas fa-exclamation-circle"></i>
                        رمز عبور باید حداقل ۶ کاراکتر باشد
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="registerConfirmPassword">تکرار رمز عبور</label>
                    <input type="password" id="registerConfirmPassword" class="form-input" placeholder="رمز عبور را مجدداً وارد کنید" required>
                    <button type="button" class="password-toggle" id="toggleRegisterConfirmPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                    <div class="form-error" id="confirmPasswordError">
                        <i class="fas fa-exclamation-circle"></i>
                        رمز عبور با تکرار آن مطابقت ندارد
                    </div>
                </div>
                
                <!-- فیلد جدید: کد دعوت -->
                <div class="form-group">
                    <label class="form-label" for="registerReferralCode">کد دعوت (اختیاری)</label>
                    <input type="text" id="registerReferralCode" class="form-input" placeholder="کد دعوت معرف خود را وارد کنید">
                    <div class="form-error" id="referralCodeError">
                        <i class="fas fa-exclamation-circle"></i>
                        کد دعوت معتبر نیست
                    </div>
                </div>
                
                <button type="submit" class="auth-btn" id="registerBtn">
                    <i class="fas fa-user-plus"></i>
                    ایجاد حساب کاربری
                </button>
            </form>
            
            <div class="auth-switch">
                <span class="auth-switch-text">قبلاً ثبت‌نام کرده‌اید؟</span>
                <button class="auth-switch-btn" id="showLoginBtn">ورود به حساب</button>
            </div>
            
            <div class="auth-terms">
                با ثبت‌نام، <a href="#">قوانین و مقررات</a> و <a href="#">حریم خصوصی</a> SODmAX CityVerse را می‌پذیرید.
            </div>
        </div>
        
        <!-- فرم ورود -->
        <div class="auth-card hidden" id="loginForm">
            <div class="auth-header">
                <div class="auth-logo">
                    <div class="auth-logo-icon">⚡</div>
                    <div class="auth-logo-text">
                        <div class="auth-logo-title">SODmAX</div>
                        <div class="auth-logo-subtitle">CityVerse Pro</div>
                    </div>
                </div>
                <h2 class="auth-title">ورود به SODmAX</h2>
                <p class="auth-subtitle">به حساب کاربری خود وارد شوید</p>
            </div>
            
            <form class="auth-form" id="loginFormElement">
                <div class="form-group">
                    <label class="form-label" for="loginPhone">شماره موبایل</label>
                    <input type="tel" id="loginPhone" class="form-input" placeholder="شماره موبایل خود را وارد کنید" required>
                    <div class="form-error" id="loginPhoneError">
                        <i class="fas fa-exclamation-circle"></i>
                        شماره موبایل خود را وارد کنید
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="loginPassword">رمز عبور</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="رمز عبور خود را وارد کنید" required>
                    <button type="button" class="password-toggle" id="toggleLoginPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                    <div class="form-error" id="loginPasswordError">
                        <i class="fas fa-exclamation-circle"></i>
                        رمز عبور خود را وارد کنید
                    </div>
                </div>
                
                <div class="form-group" style="text-align: left; margin-top: -8px;">
                    <button type="button" class="auth-switch-btn" id="forgotPasswordBtn" style="font-size: 12px;">
                        رمز عبور را فراموش کرده‌اید؟
                    </button>
                </div>
                
                <button type="submit" class="auth-btn" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    ورود به حساب
                </button>
            </form>
            
            <div class="auth-switch">
                <span class="auth-switch-text">حساب کاربری ندارید؟</span>
                <button class="auth-switch-btn" id="showRegisterBtn">ثبت‌نام کنید</button>
            </div>
        </div>
    </div>
    
    <!-- ==================== بخش اصلی اپلیکیشن ==================== -->
    <div class="app-container" id="appContainer">
        <!-- هدر موبایل -->
        <header class="mobile-header">
            <div class="logo-mobile">
                <div class="logo-icon-mobile">⚡</div>
                <div class="logo-text-mobile">
                    <div class="logo-title-mobile">SODmAX</div>
                    <div class="logo-subtitle-mobile">CityVerse Pro</div>
                </div>
            </div>
            
            <div class="header-actions-mobile">
                <button class="header-btn" onclick="showNotificationsMobile()">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge">0</span>
                </button>
                <button class="header-btn" onclick="toggleMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>
        
        <!-- منوی کشویی -->
        <div class="mobile-menu-overlay" id="mobileMenu">
            <div class="menu-header-mobile">
                <div class="user-avatar-mobile" id="userAvatar">ع</div>
                <div class="user-info-mobile">
                    <h4 id="userNameDisplay">علی محمدی</h4>
                    <p>
                        <span class="status-dot"></span>
                        <span id="userLevelDisplay">آنلاین - سطح ۵</span>
                    </p>
                </div>
            </div>
            
            <nav class="mobile-nav">
                <div class="nav-group-mobile">
                    <div class="nav-group-title-mobile">اصلی</div>
                    <a href="#dashboard" class="nav-item-mobile active" onclick="showSectionMobile('dashboard')">
                        <div class="nav-icon-mobile"><i class="fas fa-chart-pie"></i></div>
                        <div class="nav-label-mobile">داشبورد</div>
                    </a>
                    <a href="#mining" class="nav-item-mobile" onclick="showSectionMobile('mining')">
                        <div class="nav-icon-mobile"><i class="fas fa-hard-hat"></i></div>
                        <div class="nav-label-mobile">استخراج</div>
                        <span class="nav-badge-mobile">جدید</span>
                    </a>
                    <a href="#wallet" class="nav-item-mobile" onclick="showSectionMobile('wallet')">
                        <div class="nav-icon-mobile"><i class="fas fa-wallet"></i></div>
                        <div class="nav-label-mobile">کیف پول</div>
                    </a>
                    <a href="#invite" class="nav-item-mobile" onclick="showSectionMobile('invite')">
                        <div class="nav-icon-mobile"><i class="fas fa-user-plus"></i></div>
                        <div class="nav-label-mobile">دعوت دوستان</div>
                        <span class="nav-badge-mobile" id="inviteBadge">24</span>
                    </a>
                </div>
                
                <div class="nav-group-mobile">
                    <div class="nav-group-title-mobile">بازی و سرگرمی</div>
                    <a href="#missions" class="nav-item-mobile" onclick="showSectionMobile('missions')">
                        <div class="nav-icon-mobile"><i class="fas fa-tasks"></i></div>
                        <div class="nav-label-mobile">مأموریت‌ها</div>
                        <span class="nav-badge-mobile">3</span>
                    </a>
                    <a href="#rewards" class="nav-item-mobile" onclick="showSectionMobile('rewards')">
                        <div class="nav-icon-mobile"><i class="fas fa-gift"></i></div>
                        <div class="nav-label-mobile">پاداش‌ها</div>
                    </a>
                </div>
                
                <div class="nav-group-mobile">
                    <div class="nav-group-title-mobile">سیستم</div>
                    <a href="#support" class="nav-item-mobile" onclick="showSectionMobile('support')">
                        <div class="nav-icon-mobile"><i class="fas fa-headset"></i></div>
                        <div class="nav-label-mobile">پشتیبانی</div>
                    </a>
                    <a href="#settings" class="nav-item-mobile" onclick="showSectionMobile('settings')">
                        <div class="nav-icon-mobile"><i class="fas fa-cog"></i></div>
                        <div class="nav-label-mobile">تنظیمات</div>
                    </a>
                    <a href="#profile" class="nav-item-mobile" onclick="showSectionMobile('profile')">
                        <div class="nav-icon-mobile"><i class="fas fa-user"></i></div>
                        <div class="nav-label-mobile">پروفایل</div>
                    </a>
                </div>
            </nav>
            
            <div class="menu-stats-mobile">
                <div class="menu-stat">
                    <div class="stat-value-menu" id="menuSodBalance">1.8M</div>
                    <div class="stat-label-menu">SOD</div>
                </div>
                <div class="menu-stat">
                    <div class="stat-value-menu" id="menuTomanBalance">28K</div>
                    <div class="stat-label-menu">تومان</div>
                </div>
                <div class="menu-stat">
                    <div class="stat-value-menu" id="menuTotalEarned">124K</div>
                    <div class="stat-label-menu">درآمد کل</div>
                </div>
            </div>
        </div>
        
        <!-- محتوای اصلی -->
        <main class="mobile-content">
            <!-- داشبورد -->
            <section id="dashboard" class="content-section-mobile active">
                <!-- آمار سریع -->
                <div class="quick-stats-mobile">
                    <div class="quick-stat" onclick="showModalMobile('walletModal')">
                        <div class="stat-main-mobile" id="quickSodBalance">1.8M</div>
                        <div class="stat-label-mobile">SOD</div>
                    </div>
                    <div class="quick-stat" onclick="showModalMobile('walletModal')">
                        <div class="stat-main-mobile" id="quickTomanBalance">28K</div>
                        <div class="stat-label-mobile">تومان</div>
                    </div>
                    <div class="quick-stat" onclick="showModalMobile('userModal')">
                        <div class="stat-main-mobile" id="quickReferralCount">24</div>
                        <div class="stat-label-mobile">زیرمجموعه</div>
                    </div>
                </div>
                
                <!-- مرکز استخراج -->
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-hard-hat"></i>
                        مرکز استخراج SOD
                    </h3>
                    
                    <div class="miner-mobile-container">
                        <div class="miner-3d-mobile" onclick="manualMineMobile()">
                            <div class="miner-core-mobile">
                                <div class="core-icon-mobile">⚡</div>
                                <div class="click-reward-mobile" id="clickRewardMobile">+180 SOD</div>
                                <div style="color: var(--text-tertiary); font-size: 12px;">
                                    برای استخراج کلیک کنید
                                </div>
                            </div>
                        </div>
                        
                        <div class="mining-controls-mobile">
                            <button class="mining-btn-mobile" onclick="toggleAutoMiningMobile()">
                                <i class="fas fa-robot"></i>
                                <span>خودکار</span>
                            </button>
                            <button class="mining-btn-mobile" onclick="boostMiningMobile()">
                                <i class="fas fa-bolt"></i>
                                <span>افزایش قدرت</span>
                            </button>
                            <button class="mining-btn-mobile" onclick="upgradeMinerMobile()">
                                <i class="fas fa-arrow-up"></i>
                                <span>ارتقاء</span>
                            </button>
                            <button class="mining-btn-mobile" onclick="showMiningStatsMobile()">
                                <i class="fas fa-chart-bar"></i>
                                <span>آمار</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- مأموریت‌های فعال -->
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-tasks"></i>
                        مأموریت‌های فعال
                    </h3>
                    
                    <div class="mission-item-mobile" onclick="completeMissionMobile(1)">
                        <div class="mission-header-mobile">
                            <div class="mission-name-mobile">۱۰۰ کلیک در بازی</div>
                            <div class="mission-reward-mobile">+۵۰۰ تومان</div>
                        </div>
                        <div class="progress-bar-mobile">
                            <div class="progress-fill-mobile" id="mission1Progress" style="width: 45%"></div>
                        </div>
                        <div class="progress-text-mobile">
                            <span>پیشرفت</span>
                            <span id="mission1Text">۴۵/۱۰۰</span>
                        </div>
                    </div>
                    
                    <div class="mission-item-mobile" onclick="completeMissionMobile(2)">
                        <div class="mission-header-mobile">
                            <div class="mission-name-mobile">دعوت ۵ دوست</div>
                            <div class="mission-reward-mobile">+۱,۰۰۰ تومان</div>
                        </div>
                        <div class="progress-bar-mobile">
                            <div class="progress-fill-mobile" id="mission2Progress" style="width: 40%"></div>
                        </div>
                        <div class="progress-text-mobile">
                            <span>پیشرفت</span>
                            <span id="mission2Text">۲/۵</span>
                        </div>
                    </div>
                    
                    <button class="btn-mobile btn-mobile-secondary" style="margin-top: var(--space-md);" onclick="showAllMissionsMobile()">
                        <i class="fas fa-list"></i>
                        مشاهده همه مأموریت‌ها
                    </button>
                </div>
            </section>
            
            <!-- استخراج -->
            <section id="mining" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-chart-line"></i>
                        آمار استخراج
                    </h3>
                    
                    <div class="quick-stats-mobile">
                        <div class="quick-stat">
                            <div class="stat-main-mobile" id="miningPowerMobile">18x</div>
                            <div class="stat-label-mobile">قدرت</div>
                        </div>
                        <div class="quick-stat">
                            <div class="stat-main-mobile" id="miningTodayMobile">2,450</div>
                            <div class="stat-label-mobile">امروز</div>
                        </div>
                        <div class="quick-stat">
                            <div class="stat-main-mobile" id="miningTotalMobile">1.8M</div>
                            <div class="stat-label-mobile">کل</div>
                        </div>
                    </div>
                    
                    <div style="margin: var(--space-lg) 0;">
                        <h4 style="font-size: 14px; color: var(--text-tertiary); margin-bottom: var(--space-sm);">
                            <i class="fas fa-history"></i>
                            تاریخچه استخراج
                        </h4>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg);">
                            <div style="display: flex; justify-content: space-between; font-size: 12px; padding: var(--space-xs) 0;">
                                <span>امروز</span>
                                <span id="miningTodayText">+2,450 SOD</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; padding: var(--space-xs) 0; color: var(--text-tertiary);">
                                <span>دیروز</span>
                                <span>+3,210 SOD</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 12px; padding: var(--space-xs) 0; color: var(--text-tertiary);">
                                <span>هفته جاری</span>
                                <span>+15,840 SOD</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-crown"></i>
                        ارتقاء ماینر
                    </h3>
                    
                    <div style="text-align: center; margin: var(--space-lg) 0;">
                        <div style="font-size: 36px; font-weight: 900; color: var(--primary); margin-bottom: var(--space-sm);">
                            سطح <span id="minerLevel">۳</span>
                        </div>
                        <div style="font-size: 12px; color: var(--text-tertiary);">
                            تا سطح بعدی: <span id="nextLevelCost">۵۰,۰۰۰</span> SOD
                        </div>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-lg); padding: var(--space-md); margin-bottom: var(--space-lg);">
                        <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: var(--space-xs);">
                            <span>قدرت فعلی</span>
                            <span id="currentPower">۱۸x</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; margin-bottom: var(--space-xs); color: var(--text-tertiary);">
                            <span>قدرت بعدی</span>
                            <span id="nextPower">۲۳x</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-tertiary);">
                            <span>هزینه ارتقاء</span>
                            <span id="upgradeCost">۵۰,۰۰۰ SOD</span>
                        </div>
                    </div>
                    
                    <button class="btn-mobile btn-mobile-premium" onclick="upgradeMinerMobile()">
                        <i class="fas fa-arrow-up"></i>
                        ارتقاء ماینر (<span id="upgradeCostBtn">۵۰K</span> SOD)
                    </button>
                </div>
            </section>
            
            <!-- کیف پول -->
            <section id="wallet" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-wallet"></i>
                        کیف پول چند ارزی
                    </h3>
                    
                    <div class="wallet-balance-item" onclick="showModalMobile('walletModal')">
                        <div class="wallet-icon" style="background: rgba(0, 102, 255, 0.2); color: var(--primary);">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="wallet-info">
                            <div class="wallet-amount" id="walletSodBalance">1,845,200</div>
                            <div class="wallet-currency">SOD</div>
                        </div>
                    </div>
                    
                    <div class="wallet-balance-item" onclick="showModalMobile('walletModal')">
                        <div class="wallet-icon" style="background: rgba(0, 212, 170, 0.2); color: var(--secondary);">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="wallet-info">
                            <div class="wallet-amount" id="walletTomanBalance">28,400</div>
                            <div class="wallet-currency">تومان</div>
                        </div>
                    </div>
                    
                    <div class="wallet-balance-item" onclick="showModalMobile('walletModal')">
                        <div class="wallet-icon" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="wallet-info">
                            <div class="wallet-amount">120.5</div>
                            <div class="wallet-currency">USDT</div>
                        </div>
                    </div>
                    
                    <!-- اصلاح شده: دکمه‌ها در یک خط -->
                    <div class="wallet-actions-row">
                        <button class="wallet-action-row-btn" style="background: var(--gradient-secondary); color: white;" onclick="withdrawTomanMobile()">
                            <i class="fas fa-download"></i>
                            برداشت
                        </button>
                        <button class="wallet-action-row-btn" style="background: rgba(255, 255, 255, 0.1); color: var(--text-primary);" onclick="buySodMobile()">
                            <i class="fas fa-shopping-cart"></i>
                            خرید SOD
                        </button>
                        <button class="wallet-action-row-btn" style="background: var(--gradient-primary); color: white;" onclick="convertCurrencyMobile()">
                            <i class="fas fa-exchange-alt"></i>
                            تبدیل
                        </button>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-history"></i>
                        آخرین تراکنش‌ها
                    </h3>
                    
                    <div style="max-height: 300px; overflow-y: auto;" id="transactionHistory">
                        <!-- تراکنش‌ها به صورت داینامیک اضافه می‌شوند -->
                    </div>
                </div>
            </section>
            
            <!-- دعوت دوستان -->
            <section id="invite" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-user-plus"></i>
                        دعوت دوستان و کسب درآمد
                    </h3>
                    
                    <div style="text-align: center; margin-bottom: var(--space-xl);">
                        <div style="font-size: 48px; font-weight: 900; color: var(--primary); margin-bottom: var(--space-sm);">
                            🤝
                        </div>
                        <div style="font-size: 24px; font-weight: 900; color: var(--text-primary); margin-bottom: var(--space-xs);" id="referralCountMobile">
                            ۲۴ دوست دعوت کرده‌اید
                        </div>
                        <div style="font-size: 16px; color: var(--text-tertiary); margin-bottom: var(--space-lg);">
                            تاکنون <span style="color: var(--secondary); font-weight: 700;" id="totalReferralEarningsMobile">۱۲۴,۰۰۰</span> تومان از دعوت دوستان کسب کرده‌اید
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <div style="background: rgba(0, 102, 255, 0.1); border: 2px dashed var(--primary); border-radius: var(--radius-lg); padding: var(--space-lg); text-align: center; margin-bottom: var(--space-md);">
                            <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: var(--space-sm);">
                                لینک دعوت اختصاصی شما
                            </div>
                            <div style="font-size: 14px; font-weight: 700; color: var(--primary); word-break: break-all; margin-bottom: var(--space-md);" id="referralLinkMobile">
                                https://sodmax.city/invite/ali123
                            </div>
                            <button class="btn-mobile btn-mobile-primary" onclick="copyReferralLink()">
                                <i class="fas fa-copy"></i>
                                کپی لینک دعوت
                            </button>
                        </div>
                        
                        <div style="background: rgba(0, 212, 170, 0.1); border: 1px solid rgba(0, 212, 170, 0.3); border-radius: var(--radius-lg); padding: var(--space-md);">
                            <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-sm);">
                                <div style="width: 36px; height: 36px; background: var(--gradient-secondary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;">
                                    <i class="fas fa-gift"></i>
                                </div>
                                <div>
                                    <div style="font-size: 14px; font-weight: 900; color: var(--text-primary);">پاداش دعوت</div>
                                    <div style="font-size: 12px; color: var(--text-tertiary);">
                                        به ازای هر دعوت موفق: <span style="color: var(--secondary); font-weight: 700;">۱,۰۰۰ تومان</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-sm); margin-bottom: var(--space-lg);">
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 24px; font-weight: 900; color: var(--primary);" id="totalInvitesMobile">۲۴</div>
                            <div style="font-size: 11px; color: var(--text-tertiary);">کل دعوت‌ها</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 24px; font-weight: 900; color: var(--secondary);" id="activeInvitesMobile">۱۸</div>
                            <div style="font-size: 11px; color: var(--text-tertiary);">فعال</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 24px; font-weight: 900; color: var(--accent);" id="pendingInvitesMobile">۳</div>
                            <div style="font-size: 11px; color: var(--text-tertiary);">در انتظار</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 24px; font-weight: 900; color: var(--premium);" id="totalEarnedInvitesMobile">۱۲۴K</div>
                            <div style="font-size: 11px; color: var(--text-tertiary);">درآمد کل</div>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-share-alt"></i>
                        اشتراک‌گذاری
                    </h3>
                    
                    <!-- اصلاح شده: دکمه‌های اشتراک‌گذاری با چیدمان بهتر -->
                    <div class="share-buttons-grid">
                        <button class="share-button" onclick="shareViaWhatsApp()">
                            <i class="fab fa-whatsapp"></i>
                            واتساپ
                        </button>
                        <button class="share-button" onclick="shareViaTelegram()">
                            <i class="fab fa-telegram"></i>
                            تلگرام
                        </button>
                        <button class="share-button" onclick="shareViaInstagram()">
                            <i class="fab fa-instagram"></i>
                            اینستاگرام
                        </button>
                    </div>
                    
                    <div style="background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-lg); padding: var(--space-md);">
                        <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: var(--space-sm);">
                            کد دعوت اختصاصی
                        </div>
                        <div style="display: flex; align-items: center; gap: var(--space-sm);">
                            <div style="flex: 1; background: rgba(255, 255, 255, 0.1); padding: var(--space-md); border-radius: var(--radius-md); font-family: monospace; font-size: 14px; font-weight: 700; letter-spacing: 1px; text-align: center;" id="referralCodeMobile">
                                ALI12345
                            </div>
                            <button class="btn-mobile btn-mobile-primary" style="width: auto; padding: var(--space-md) var(--space-lg);" onclick="copyReferralCode()">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- مأموریت‌ها -->
            <section id="missions" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-trophy"></i>
                        دستاوردهای شما
                    </h3>
                    
                    <div style="display: flex; gap: var(--space-sm); flex-wrap: wrap; margin-bottom: var(--space-lg);">
                        <div style="background: var(--gradient-primary); color: white; padding: var(--space-xs) var(--space-md); border-radius: var(--radius-full); font-size: 12px; font-weight: 600;">
                            🥇 طلایی
                        </div>
                        <div style="background: var(--gradient-secondary); color: white; padding: var(--space-xs) var(--space-md); border-radius: var(--radius-full); font-size: 12px; font-weight: 600;">
                            🤝 دعوت‌کننده
                        </div>
                        <div style="background: var(--gradient-accent); color: white; padding: var(--space-xs) var(--space-md); border-radius: var(--radius-full); font-size: 12px; font-weight: 600;">
                            ⚡ سریع
                        </div>
                        <div style="background: var(--gradient-premium); color: #000; padding: var(--space-xs) var(--space-md); border-radius: var(--radius-full); font-size: 12px; font-weight: 600;">
                            💎 الماسی
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <div style="font-size: 48px; font-weight: 900; color: var(--text-primary); margin-bottom: var(--space-xs);" id="completedMissions">۴۸</div>
                        <div style="font-size: 12px; color: var(--text-tertiary);">مأموریت تکمیل شده</div>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-star"></i>
                        مأموریت‌های ویژه
                    </h3>
                    
                    <div class="mission-item-mobile">
                        <div class="mission-header-mobile">
                            <div class="mission-name-mobile">رسیدن به سطح ۱۰</div>
                            <div class="mission-reward-mobile">+۱۰,۰۰۰ تومان</div>
                        </div>
                        <div class="progress-bar-mobile">
                            <div class="progress-fill-mobile" style="width: 50%"></div>
                        </div>
                        <div class="progress-text-mobile">
                            <span>پیشرفت</span>
                            <span>سطح ۵/۱۰</span>
                        </div>
                    </div>
                    
                    <div class="mission-item-mobile">
                        <div class="mission-header-mobile">
                            <div class="mission-name-mobile">دعوت ۱۰۰ زیرمجموعه</div>
                            <div class="mission-reward-mobile">+۵۰,۰۰۰ تومان</div>
                        </div>
                        <div class="progress-bar-mobile">
                            <div class="progress-fill-mobile" style="width: 24%"></div>
                        </div>
                        <div class="progress-text-mobile">
                            <span>پیشرفت</span>
                            <span>۲۴/۱۰۰</span>
                        </div>
                    </div>
                    
                    <div class="mission-item-mobile">
                        <div class="mission-header-mobile">
                            <div class="mission-name-mobile">استخراج ۱۰ میلیون SOD</div>
                            <div class="mission-reward-mobile">+۱۰۰,۰۰۰ تومان</div>
                        </div>
                        <div class="progress-bar-mobile">
                            <div class="progress-fill-mobile" style="width: 18.5%"></div>
                        </div>
                        <div class="progress-text-mobile">
                            <span>پیشرفت</span>
                            <span>۱.۸۵M/۱۰M</span>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- پاداش‌ها -->
            <section id="rewards" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-gift"></i>
                        پاداش‌های ویژه
                    </h3>
                    
                    <div class="rewards-grid-mobile">
                        <div class="reward-item-mobile" onclick="claimRewardMobile('sod')">
                            <div class="reward-icon-mobile">🎁</div>
                            <div class="reward-amount-mobile">۱۰,۰۰۰</div>
                            <div class="reward-type-mobile">SOD</div>
                        </div>
                        
                        <div class="reward-item-mobile" onclick="claimRewardMobile('toman')">
                            <div class="reward-icon-mobile">💰</div>
                            <div class="reward-amount-mobile">۵,۰۰۰</div>
                            <div class="reward-type-mobile">تومان</div>
                        </div>
                        
                        <div class="reward-item-mobile" onclick="claimRewardMobile('boost')">
                            <div class="reward-icon-mobile">⚡</div>
                            <div class="reward-amount-mobile">۳x</div>
                            <div class="reward-type-mobile">بوست</div>
                        </div>
                        
                        <div class="reward-item-mobile" onclick="claimRewardMobile('premium')">
                            <div class="reward-icon-mobile">👑</div>
                            <div class="reward-amount-mobile">۷ روز</div>
                            <div class="reward-type-mobile">Pro</div>
                        </div>
                    </div>
                    
                    <button class="btn-mobile btn-mobile-success" style="margin-top: var(--space-lg);" onclick="claimAllRewardsMobile()">
                        <i class="fas fa-gift"></i>
                        دریافت همه پاداش‌ها
                    </button>
                </div>
                
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-calendar-alt"></i>
                        پاداش روزانه
                    </h3>
                    
                    <div style="text-align: center; margin: var(--space-lg) 0;">
                        <div style="font-size: 48px; font-weight: 900; color: var(--primary);">🎁</div>
                        <div style="font-size: 16px; font-weight: 900; color: var(--text-primary); margin: var(--space-sm) 0;">
                            پاداش روزانه شما آماده است!
                        </div>
                        <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: var(--space-lg);">
                            هر روز وارد شوید و پاداش دریافت کنید
                        </div>
                        
                        <button class="btn-mobile btn-mobile-primary" onclick="claimDailyReward()">
                            <i class="fas fa-gift"></i>
                            دریافت پاداش روزانه
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- پروفایل کاربری -->
            <section id="profile" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-user"></i>
                        پروفایل کاربری
                    </h3>
                    
                    <div style="text-align: center; margin-bottom: var(--space-xl);">
                        <div class="user-avatar-mobile" style="width: 100px; height: 100px; margin: 0 auto var(--space-lg); font-size: 40px;" id="profileAvatar">
                            ع
                        </div>
                        <h4 style="font-size: 24px; font-weight: 900; margin-bottom: var(--space-xs); background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;" id="profileName">
                            علی محمدی
                        </h4>
                        <p style="color: var(--text-tertiary); font-size: 14px; margin-bottom: var(--space-md);" id="profilePhone">
                            <i class="fas fa-phone"></i> ۰۹۱۲۳۴۵۶۷۸۹
                        </p>
                        <div style="background: var(--gradient-primary); color: white; padding: var(--space-xs) var(--space-lg); border-radius: var(--radius-full); display: inline-block; font-size: 12px; font-weight: 700;">
                            سطح <span id="profileLevel">۵</span>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-sm); margin-bottom: var(--space-xl);">
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 12px; color: var(--text-tertiary);">عضویت از</div>
                            <div style="font-size: 14px; font-weight: 900; color: var(--text-primary);" id="profileJoinDate">۱۴۰۲/۰۵/۱۰</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 12px; color: var(--text-tertiary);">آخرین ورود</div>
                            <div style="font-size: 14px; font-weight: 900; color: var(--text-primary);" id="profileLastLogin">امروز</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 12px; color: var(--text-tertiary);">زیرمجموعه</div>
                            <div style="font-size: 14px; font-weight: 900; color: var(--primary);" id="profileReferrals">۲۴</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                            <div style="font-size: 12px; color: var(--text-tertiary);">درآمد کل</div>
                            <div style="font-size: 14px; font-weight: 900; color: var(--secondary);" id="profileTotalEarned">۱۲۴K</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <button class="btn-mobile btn-mobile-secondary" style="margin-bottom: var(--space-sm);" onclick="editProfileMobile()">
                            <i class="fas fa-edit"></i>
                            ویرایش پروفایل
                        </button>
                        <button class="btn-mobile btn-mobile-secondary" style="margin-bottom: var(--space-sm);" onclick="changePasswordMobile()">
                            <i class="fas fa-key"></i>
                            تغییر رمز عبور
                        </button>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="btn-mobile" style="background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);" onclick="logoutMobile()">
                            <i class="fas fa-sign-out-alt"></i>
                            خروج از حساب
                        </button>
                    </div>
                </div>
            </section>
            
            <!-- پشتیبانی -->
            <section id="support" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-headset"></i>
                        پشتیبانی آنلاین
                    </h3>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-md);">
                            <div style="width: 48px; height: 48px; background: var(--gradient-primary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div>
                                <div style="font-size: 16px; font-weight: 900; color: var(--text-primary);">چت آنلاین</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">پاسخگویی ۲۴ ساعته</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: var(--space-sm); margin-bottom: var(--space-md);">
                            <div style="width: 48px; height: 48px; background: var(--gradient-secondary); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div>
                                <div style="font-size: 16px; font-weight: 900; color: var(--text-primary);">سوالات متداول</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">پاسخ به رایج‌ترین سوالات</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: var(--space-sm);">
                            <div style="width: 48px; height: 48px; background: var(--gradient-accent); border-radius: var(--radius-full); display: flex; align-items: center; justify-content: center; color: white; font-size: 20px;">
                                <i class="fas fa-book"></i>
                            </div>
                            <div>
                                <div style="font-size: 16px; font-weight: 900; color: var(--text-primary);">آموزش‌ها</div>
                                <div style="font-size: 12px; color: var(--text-tertiary);">ویدیو و راهنمای تصویری</div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn-mobile btn-mobile-primary" onclick="startChatSupport()">
                        <i class="fas fa-comment-dots"></i>
                        شروع گفتگوی آنلاین
                    </button>
                </div>
            </section>
            
            <!-- تنظیمات -->
            <section id="settings" class="content-section-mobile">
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-user-cog"></i>
                        تنظیمات حساب
                    </h3>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="font-size: 14px; color: var(--text-primary);">حالت شب</span>
                            <label class="switch">
                                <input type="checkbox" checked id="darkModeToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="font-size: 14px; color: var(--text-primary);">اعلان‌ها</span>
                            <label class="switch">
                                <input type="checkbox" checked id="notificationsToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <span style="font-size: 14px; color: var(--text-primary);">صدا</span>
                            <label class="switch">
                                <input type="checkbox" checked id="soundToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) 0;">
                            <span style="font-size: 14px; color: var(--text-primary);">ویبره</span>
                            <label class="switch">
                                <input type="checkbox" checked id="vibrationToggle">
                                <span class="slider round"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-lg);">
                        <button class="btn-mobile btn-mobile-secondary" style="margin-bottom: var(--space-sm);" onclick="changePasswordMobile()">
                            <i class="fas fa-key"></i>
                            تغییر رمز عبور
                        </button>
                        <button class="btn-mobile btn-mobile-secondary" style="margin-bottom: var(--space-sm);" onclick="editProfileMobile()">
                            <i class="fas fa-edit"></i>
                            ویرایش پروفایل
                        </button>
                        <button class="btn-mobile btn-mobile-secondary" onclick="languageSettingsMobile()">
                            <i class="fas fa-language"></i>
                            زبان و منطقه
                        </button>
                    </div>
                </div>
                
                <div class="mobile-card">
                    <h3 class="card-title-mobile">
                        <i class="fas fa-info-circle"></i>
                        درباره برنامه
                    </h3>
                    
                    <div style="text-align: center;">
                        <div style="font-size: 36px; color: var(--primary); margin-bottom: var(--space-sm);">
                            ⚡🏙️
                        </div>
                        <div style="font-size: 18px; font-weight: 900; color: var(--text-primary); margin-bottom: var(--space-xs);">
                            SODmAX CityVerse
                        </div>
                        <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: var(--space-lg);">
                            نسخه ۲.۰.۰ | Pro Edition
                        </div>
                        
                        <div style="font-size: 12px; color: var(--text-secondary); text-align: right; line-height: 1.6;">
                            <p>پلتفرم پیشرفته درآمدزایی و بازی‌سازی</p>
                            <p>استخراج هوشمند • شهر دیجیتال • کسب‌وکار آنلاین</p>
                            <p>© ۲۰۲۴ تمامی حقوق محفوظ است</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- نوار پایین -->
        <nav class="mobile-bottom-nav">
            <a href="#dashboard" class="bottom-nav-item active" onclick="showSectionMobile('dashboard')">
                <i class="fas fa-home bottom-nav-icon"></i>
                <span class="bottom-nav-label">داشبورد</span>
            </a>
            <a href="#mining" class="bottom-nav-item" onclick="showSectionMobile('mining')">
                <i class="fas fa-hard-hat bottom-nav-icon"></i>
                <span class="bottom-nav-label">استخراج</span>
            </a>
            <a href="#wallet" class="bottom-nav-item" onclick="showSectionMobile('wallet')">
                <i class="fas fa-wallet bottom-nav-icon"></i>
                <span class="bottom-nav-label">کیف پول</span>
            </a>
            <a href="#invite" class="bottom-nav-item" onclick="showSectionMobile('invite')">
                <i class="fas fa-user-plus bottom-nav-icon"></i>
                <span class="bottom-nav-label">دعوت دوستان</span>
            </a>
            <a href="#rewards" class="bottom-nav-item" onclick="showSectionMobile('rewards')">
                <i class="fas fa-gift bottom-nav-icon"></i>
                <span class="bottom-nav-label">پاداش‌ها</span>
            </a>
        </nav>
    </div>
    
    <!-- مودال کیف پول -->
    <div class="modal-mobile-overlay" id="walletModal">
        <div class="modal-mobile-content">
            <div class="modal-header-mobile">
                <h3 class="modal-title-mobile">کیف پول چند ارزی</h3>
                <button class="close-modal-mobile" onclick="closeModalMobile('walletModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="margin-bottom: var(--space-xl);">
                <div style="background: rgba(0, 102, 255, 0.15); padding: var(--space-lg); border-radius: var(--radius-lg); text-align: center; margin-bottom: var(--space-md);">
                    <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: var(--space-sm);">موجودی SOD</div>
                    <div style="font-size: 24px; font-weight: 900; color: var(--primary);" id="modalSodBalance">1,845,200 SOD</div>
                </div>
                
                <div style="background: rgba(0, 212, 170, 0.15); padding: var(--space-lg); border-radius: var(--radius-lg); text-align: center; margin-bottom: var(--space-md);">
                    <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: var(--space-sm);">موجودی تومان</div>
                    <div style="font-size: 24px; font-weight: 900; color: var(--secondary);" id="modalTomanBalance">28,400 تومان</div>
                </div>
                
                <div style="background: rgba(59, 130, 246, 0.15); padding: var(--space-lg); border-radius: var(--radius-lg); text-align: center;">
                    <div style="font-size: 12px; color: var(--text-tertiary); margin-bottom: var(--space-sm);">موجودی USDT</div>
                    <div style="font-size: 24px; font-weight: 900; color: #3b82f6;">120.5 USDT</div>
                </div>
            </div>
            
            <!-- اصلاح شده: دکمه‌ها در یک خط -->
            <div class="wallet-actions-row">
                <button class="wallet-action-row-btn" style="background: var(--gradient-secondary); color: white;" onclick="withdrawTomanMobile()">
                    <i class="fas fa-download"></i>
                    برداشت
                </button>
                <button class="wallet-action-row-btn" style="background: rgba(255, 255, 255, 0.1); color: var(--text-primary);" onclick="buySodMobile()">
                    <i class="fas fa-shopping-cart"></i>
                    خرید
                </button>
                <button class="wallet-action-row-btn" style="background: var(--gradient-primary); color: white;" onclick="convertCurrencyMobile()">
                    <i class="fas fa-exchange-alt"></i>
                    تبدیل
                </button>
            </div>
        </div>
    </div>
    
    <!-- مودال کاربر -->
    <div class="modal-mobile-overlay" id="userModal">
        <div class="modal-mobile-content">
            <div class="modal-header-mobile">
                <h3 class="modal-title-mobile">پروفایل کاربری</h3>
                <button class="close-modal-mobile" onclick="closeModalMobile('userModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="text-align: center; margin-bottom: var(--space-xl);">
                <div class="user-avatar-mobile" style="width: 80px; height: 80px; margin: 0 auto var(--space-lg); font-size: 32px;" id="modalUserAvatar">
                    ع
                </div>
                <h4 style="font-size: 20px; font-weight: 900; margin-bottom: var(--space-xs); background: var(--gradient-primary); -webkit-background-clip: text; -webkit-text-fill-color: transparent;" id="modalUserName">
                    علی محمدی
                </h4>
                <p style="color: var(--text-tertiary); font-size: 12px;" id="modalUserPhone">
                    <i class="fas fa-calendar-alt"></i> عضو از ۱۴۰۲/۰۵/۱۰
                </p>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-sm); margin-bottom: var(--space-xl);">
                <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                    <div style="font-size: 12px; color: var(--text-tertiary);">سطح</div>
                    <div style="font-size: 24px; font-weight: 900; color: var(--primary);" id="modalUserLevel">۵</div>
                </div>
                <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                    <div style="font-size: 12px; color: var(--text-tertiary);">درآمد کل</div>
                    <div style="font-size: 24px; font-weight: 900; color: var(--secondary);" id="modalUserTotalEarned">۱۲۴K</div>
                </div>
                <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                    <div style="font-size: 12px; color: var(--text-tertiary);">زیرمجموعه</div>
                    <div style="font-size: 24px; font-weight: 900; color: var(--city-purple);" id="modalUserReferrals">۲۴</div>
                </div>
                <div style="background: rgba(255, 255, 255, 0.05); padding: var(--space-md); border-radius: var(--radius-lg); text-align: center;">
                    <div style="font-size: 12px; color: var(--text-tertiary);">مأموریت</div>
                    <div style="font-size: 24px; font-weight: 900; color: var(--city-yellow);" id="modalUserMissions">۴۸</div>
                </div>
            </div>
            
            <button class="btn-mobile btn-mobile-primary" style="width: 100%;" onclick="editProfileMobile()">
                <i class="fas fa-edit"></i>
                ویرایش پروفایل
            </button>
        </div>
    </div>
    
    <!-- مودال نوتیفیکیشن -->
    <div class="modal-mobile-overlay" id="notificationModal">
        <div class="modal-mobile-content">
            <div class="modal-header-mobile">
                <h3 class="modal-title-mobile">نوتیفیکیشن‌ها</h3>
                <button class="close-modal-mobile" onclick="closeModalMobile('notificationModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div style="max-height: 400px; overflow-y: auto;" id="notificationsList">
                <!-- نوتیفیکیشن‌ها به صورت داینامیک اضافه می‌شوند -->
            </div>
        </div>
    </div>
    
    <!-- کانتینر توست -->
    <div class="toast-container-mobile" id="toastContainerMobile"></div>
    
    <script>
        // ==================== Supabase Configuration ====================
        const SUPABASE_URL = 'https://bnjwmytwuegchetspcrw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJuandteXR3dWVnY2hldHNwY3J3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4ODE2ODUsImV4cCI6MjA4MzQ1NzY4NX0.j6QToxnBTNKkSeT7NnISbJ4KZvcYrUCnhkBetfIObfY';

        // ایجاد کلاینت Supabase
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ==================== مدیریت Supabase ====================
        class SupabaseManager {
            constructor() {
                this.client = supabaseClient;
            }

            // دریافت کاربران
            async getUsers() {
                try {
                    const { data, error } = await this.client
                        .from('users')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('خطا در دریافت کاربران:', error);
                    return [];
                }
            }

            // دریافت کاربر بر اساس ID
            async getUserById(userId) {
                try {
                    const { data, error } = await this.client
                        .from('users')
                        .select('*')
                        .eq('id', userId)
                        .single();
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('خطا در دریافت کاربر:', error);
                    return null;
                }
            }

            // دریافت کاربر بر اساس شماره موبایل
            async getUserByPhone(phone) {
                try {
                    const { data, error } = await this.client
                        .from('users')
                        .select('*')
                        .eq('phone', phone)
                        .single();
                    
                    if (error) {
                        if (error.code === 'PGRST116') return null;
                        throw error;
                    }
                    return data;
                } catch (error) {
                    console.error('خطا در جستجوی کاربر:', error);
                    return null;
                }
            }

            // دریافت کاربر بر اساس کد دعوت
            async getUserByReferralCode(referralCode) {
                try {
                    const { data, error } = await this.client
                        .from('users')
                        .select('*')
                        .eq('referral_code', referralCode)
                        .single();
                    
                    if (error) {
                        if (error.code === 'PGRST116') return null;
                        throw error;
                    }
                    return data;
                } catch (error) {
                    console.error('خطا در جستجوی کاربر با کد دعوت:', error);
                    return null;
                }
            }

            // ایجاد کاربر جدید
            async createUser(userData) {
                try {
                    const { data, error } = await this.client
                        .from('users')
                        .insert([{
                            name: userData.name,
                            phone: userData.phone,
                            password: userData.password,
                            avatar: userData.avatar,
                            level: userData.level,
                            total_earned: userData.totalEarned,
                            referral_count: userData.referralCount,
                            referral_earnings: userData.referralEarnings,
                            join_date: userData.joinDate,
                            last_login: userData.lastLogin,
                            sod_balance: userData.sodBalance,
                            toman_balance: userData.tomanBalance,
                            mining_power: userData.miningPower,
                            mining_multiplier: userData.miningMultiplier,
                            auto_mining: userData.autoMining,
                            today_earned: userData.todayEarned,
                            total_mined: userData.totalMined,
                            completed_missions: userData.completedMissions,
                            referral_code: userData.referralCode,
                            referral_link: userData.referralLink
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در ایجاد کاربر:', error);
                    return { success: false, error: error.message };
                }
            }

            // به‌روزرسانی کاربر
            async updateUser(userId, updates) {
                try {
                    const { data, error } = await this.client
                        .from('users')
                        .update({
                            name: updates.name,
                            avatar: updates.avatar,
                            level: updates.level,
                            total_earned: updates.totalEarned,
                            referral_count: updates.referralCount,
                            referral_earnings: updates.referralEarnings,
                            last_login: updates.lastLogin,
                            sod_balance: updates.sodBalance,
                            toman_balance: updates.tomanBalance,
                            mining_power: updates.miningPower,
                            mining_multiplier: updates.miningMultiplier,
                            auto_mining: updates.autoMining,
                            today_earned: updates.todayEarned,
                            total_mined: updates.totalMined,
                            completed_missions: updates.completedMissions,
                            referral_code: updates.referralCode,
                            referral_link: updates.referralLink,
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', userId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در به‌روزرسانی کاربر:', error);
                    return { success: false, error: error.message };
                }
            }

            // دریافت تراکنش‌ها
            async getTransactions(userId) {
                try {
                    const { data, error } = await this.client
                        .from('transactions')
                        .select('*')
                        .eq('user_id', userId)
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('خطا در دریافت تراکنش‌ها:', error);
                    return [];
                }
            }

            // ایجاد تراکنش
            async createTransaction(transactionData) {
                try {
                    const { data, error } = await this.client
                        .from('transactions')
                        .insert([{
                            user_id: transactionData.userId,
                            type: transactionData.type,
                            amount: transactionData.amount,
                            currency: transactionData.currency,
                            status: transactionData.status,
                            date: transactionData.date,
                            icon: transactionData.icon,
                            color: transactionData.color
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در ایجاد تراکنش:', error);
                    return { success: false, error: error.message };
                }
            }

            // دریافت نوتیفیکیشن‌ها
            async getNotifications(userId) {
                try {
                    const { data, error } = await this.client
                        .from('notifications')
                        .select('*')
                        .eq('user_id', userId)
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('خطا در دریافت نوتیفیکیشن‌ها:', error);
                    return [];
                }
            }

            // ایجاد نوتیفیکیشن
            async createNotification(notificationData) {
                try {
                    const { data, error } = await this.client
                        .from('notifications')
                        .insert([{
                            user_id: notificationData.userId,
                            title: notificationData.title,
                            message: notificationData.message,
                            time: notificationData.time,
                            read: notificationData.read
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در ایجاد نوتیفیکیشن:', error);
                    return { success: false, error: error.message };
                }
            }

            // بروزرسانی نوتیفیکیشن به عنوان خوانده شده
            async markNotificationAsRead(notificationId) {
                try {
                    const { data, error } = await this.client
                        .from('notifications')
                        .update({ read: true })
                        .eq('id', notificationId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در بروزرسانی نوتیفیکیشن:', error);
                    return { success: false, error: error.message };
                }
            }

            // دریافت دعوت‌ها
            async getReferrals(userId) {
                try {
                    const { data, error } = await this.client
                        .from('referrals')
                        .select('*')
                        .eq('user_id', userId)
                        .single();
                    
                    if (error) {
                        if (error.code === 'PGRST116') return null;
                        throw error;
                    }
                    return data;
                } catch (error) {
                    console.error('خطا در دریافت دعوت‌ها:', error);
                    return null;
                }
            }

            // ایجاد دعوت‌ها
            async createReferrals(referralsData) {
                try {
                    const { data, error } = await this.client
                        .from('referrals')
                        .insert([{
                            user_id: referralsData.userId,
                            total_invites: referralsData.totalInvites,
                            active_invites: referralsData.activeInvites,
                            pending_invites: referralsData.pendingInvites,
                            total_earned: referralsData.totalEarned,
                            referral_code: referralsData.referralCode,
                            referral_link: referralsData.referralLink
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در ایجاد دعوت‌ها:', error);
                    return { success: false, error: error.message };
                }
            }

            // به‌روزرسانی دعوت‌ها
            async updateReferrals(referralsId, updates) {
                try {
                    const { data, error } = await this.client
                        .from('referrals')
                        .update({
                            total_invites: updates.totalInvites,
                            active_invites: updates.activeInvites,
                            pending_invites: updates.pendingInvites,
                            total_earned: updates.totalEarned,
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', referralsId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در به‌روزرسانی دعوت‌ها:', error);
                    return { success: false, error: error.message };
                }
            }

            // ایجاد تنظیمات پیش‌فرض
            async createDefaultSettings(userId) {
                try {
                    const { data, error } = await this.client
                        .from('user_settings')
                        .insert([{
                            user_id: userId,
                            dark_mode: true,
                            notifications: true,
                            sound: true,
                            vibration: true,
                            language: 'fa'
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در ایجاد تنظیمات پیش‌فرض:', error);
                    return { success: false, error: error.message };
                }
            }

            // دریافت تنظیمات
            async getUserSettings(userId) {
                try {
                    const { data, error } = await this.client
                        .from('user_settings')
                        .select('*')
                        .eq('user_id', userId)
                        .single();
                    
                    if (error) {
                        if (error.code === 'PGRST116') {
                            return await this.createDefaultSettings(userId);
                        }
                        throw error;
                    }
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در دریافت تنظیمات:', error);
                    return { success: false, error: error.message };
                }
            }

            // به‌روزرسانی تنظیمات
            async updateSettings(settingsId, updates) {
                try {
                    const { data, error } = await this.client
                        .from('user_settings')
                        .update({
                            dark_mode: updates.darkMode,
                            notifications: updates.notifications,
                            sound: updates.sound,
                            vibration: updates.vibration,
                            language: updates.language,
                            updated_at: new Date().toISOString()
                        })
                        .eq('id', settingsId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return { success: true, data };
                } catch (error) {
                    console.error('خطا در به‌روزرسانی تنظیمات:', error);
                    return { success: false, error: error.message };
                }
            }
        }

        // ایجاد نمونه از مدیر Supabase
        const supabaseManager = new SupabaseManager();

        // ==================== سیستم مدیریت کاربران ====================
        class UserManager {
            constructor() {
                this.currentUser = null;
                this.currentUserKey = 'sodmax_current_user';
                this.supabase = supabaseManager;
                
                this.initializeDefaultMissions();
            }
            
            async initializeDefaultMissions() {
                this.gameData = {
                    missions: {
                        active: [
                            { id: 1, name: "۱۰۰ کلیک در بازی", reward: 500, progress: 45, max: 100 },
                            { id: 2, name: "دعوت ۵ دوست", reward: 1000, progress: 2, max: 5 }
                        ]
                    }
                };
            }
            
            hashPassword(password) {
                return btoa(password);
            }
            
            verifyPassword(password, hashedPassword) {
                return this.hashPassword(password) === hashedPassword;
            }
            
            async register(name, phone, password, referralCode = null) {
                try {
                    const existingUser = await this.supabase.getUserByPhone(phone);
                    if (existingUser) {
                        return { success: false, message: "این شماره موبایل قبلاً ثبت‌نام کرده است" };
                    }
                    
                    const newUser = {
                        name: name,
                        phone: phone,
                        password: this.hashPassword(password),
                        avatar: name.charAt(0),
                        level: 1,
                        totalEarned: 0,
                        referralCount: 0,
                        referralEarnings: 0,
                        joinDate: new Date().toLocaleDateString('fa-IR'),
                        lastLogin: new Date().toLocaleDateString('fa-IR'),
                        sodBalance: 1000,
                        tomanBalance: 0,
                        miningPower: 5,
                        miningMultiplier: 1,
                        autoMining: false,
                        todayEarned: 0,
                        totalMined: 0,
                        completedMissions: 0,
                        referralCode: this.generateReferralCode(name),
                        referralLink: `https://sodmax.city/invite/${this.generateReferralCode(name)}`
                    };
                    
                    const result = await this.supabase.createUser(newUser);
                    if (!result.success) {
                        return { success: false, message: "خطا در ثبت‌نام: " + result.error };
                    }
                    
                    const createdUser = result.data;
                    
                    let referralBonus = 0;
                    if (referralCode) {
                        const referrer = await this.supabase.getUserByReferralCode(referralCode);
                        if (referrer) {
                            referrer.toman_balance += 1000;
                            referrer.total_earned += 1000;
                            referrer.referral_earnings += 1000;
                            referrer.referral_count++;
                            
                            await this.supabase.updateUser(referrer.id, referrer);
                            
                            await this.supabase.createTransaction({
                                userId: referrer.id,
                                type: "پاداش دعوت",
                                amount: 1000,
                                currency: "تومان",
                                status: "موفق",
                                icon: "fa-user-plus",
                                color: "var(--secondary)",
                                date: new Date().toLocaleDateString('fa-IR') + " - " + new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' })
                            });
                            
                            createdUser.sod_balance += 500;
                            referralBonus = 500;
                            
                            await this.supabase.updateUser(createdUser.id, createdUser);
                            
                            await this.supabase.createNotification({
                                userId: referrer.id,
                                title: "🤝 دعوت موفق",
                                message: `${name} با کد دعوت شما ثبت‌نام کرد! +۱,۰۰۰ تومان پاداش`,
                                time: "همین حالا",
                                read: false
                            });
                        }
                    }
                    
                    await this.supabase.createReferrals({
                        userId: createdUser.id,
                        totalInvites: 0,
                        activeInvites: 0,
                        pendingInvites: 0,
                        totalEarned: 0,
                        referralCode: createdUser.referral_code,
                        referralLink: createdUser.referral_link
                    });
                    
                    await this.supabase.createDefaultSettings(createdUser.id);
                    
                    await this.supabase.createNotification({
                        userId: createdUser.id,
                        title: "👋 به SODmAX خوش آمدید",
                        message: `حساب کاربری شما با موفقیت ایجاد شد! ۱۰۰۰ SOD هدیه دریافت کردید. ${referralBonus > 0 ? `+ ${referralBonus} SOD پاداش دعوت` : ''}`,
                        time: "همین حالا",
                        read: false
                    });
                    
                    const formattedUser = this.formatUserFromSupabase(createdUser);
                    
                    return { 
                        success: true, 
                        user: formattedUser,
                        referralBonus: referralBonus
                    };
                    
                } catch (error) {
                    console.error('خطا در ثبت‌نام:', error);
                    return { success: false, message: "خطا در ثبت‌نام" };
                }
            }
            
            generateReferralCode(name) {
                const namePart = name.replace(/\s/g, '').substring(0, 3).toUpperCase();
                const randomPart = Math.floor(10000 + Math.random() * 90000);
                return `${namePart}${randomPart}`;
            }
            
            async login(phone, password) {
                try {
                    const user = await this.supabase.getUserByPhone(phone);
                    
                    if (!user) {
                        return { success: false, message: "شماره موبایل یا رمز عبور اشتباه است" };
                    }
                    
                    if (!this.verifyPassword(password, user.password)) {
                        return { success: false, message: "شماره موبایل یا رمز عبور اشتباه است" };
                    }
                    
                    user.last_login = new Date().toLocaleDateString('fa-IR');
                    await this.supabase.updateUser(user.id, user);
                    
                    const formattedUser = this.formatUserFromSupabase(user);
                    localStorage.setItem(this.currentUserKey, JSON.stringify(formattedUser));
                    this.currentUser = formattedUser;
                    
                    await this.loadUserData(user.id);
                    
                    return { success: true, user: formattedUser };
                    
                } catch (error) {
                    console.error('خطا در ورود:', error);
                    return { success: false, message: "خطا در ورود به سیستم" };
                }
            }
            
            async loadUserData(userId) {
                try {
                    const [transactions, notifications, referrals, settings] = await Promise.all([
                        this.supabase.getTransactions(userId),
                        this.supabase.getNotifications(userId),
                        this.supabase.getReferrals(userId),
                        this.supabase.getUserSettings(userId)
                    ]);
                    
                    localStorage.setItem('sodmax_transactions', JSON.stringify(transactions));
                    localStorage.setItem('sodmax_notifications', JSON.stringify(notifications));
                    localStorage.setItem('sodmax_referrals', JSON.stringify(referrals));
                    
                    if (settings.success) {
                        localStorage.setItem('sodmax_settings', JSON.stringify(settings.data));
                    }
                    
                } catch (error) {
                    console.error('خطا در بارگذاری داده‌های کاربر:', error);
                }
            }
            
            logout() {
                localStorage.removeItem(this.currentUserKey);
                localStorage.removeItem('sodmax_transactions');
                localStorage.removeItem('sodmax_notifications');
                localStorage.removeItem('sodmax_referrals');
                localStorage.removeItem('sodmax_settings');
                this.currentUser = null;
                return true;
            }
            
            getCurrentUser() {
                if (!this.currentUser) {
                    const storedUser = localStorage.getItem(this.currentUserKey);
                    if (storedUser) {
                        this.currentUser = JSON.parse(storedUser);
                    }
                }
                return this.currentUser;
            }
            
            async updateUser(updatedUser) {
                try {
                    const supabaseUser = this.formatUserToSupabase(updatedUser);
                    
                    const result = await this.supabase.updateUser(updatedUser.id, supabaseUser);
                    if (!result.success) {
                        return false;
                    }
                    
                    if (this.currentUser && this.currentUser.id === updatedUser.id) {
                        this.currentUser = updatedUser;
                        localStorage.setItem(this.currentUserKey, JSON.stringify(updatedUser));
                    }
                    
                    return true;
                    
                } catch (error) {
                    console.error('خطا در به‌روزرسانی کاربر:', error);
                    return false;
                }
            }
            
            async getTransactions(userId) {
                try {
                    const localTransactions = localStorage.getItem('sodmax_transactions');
                    if (localTransactions) {
                        return JSON.parse(localTransactions);
                    }
                    
                    const transactions = await this.supabase.getTransactions(userId);
                    localStorage.setItem('sodmax_transactions', JSON.stringify(transactions));
                    return transactions;
                    
                } catch (error) {
                    console.error('خطا در دریافت تراکنش‌ها:', error);
                    return [];
                }
            }
            
            async addTransaction(userId, transaction) {
                try {
                    transaction.date = new Date().toLocaleDateString('fa-IR') + " - " + new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' });
                    
                    const result = await this.supabase.createTransaction({
                        userId: userId,
                        type: transaction.type,
                        amount: transaction.amount,
                        currency: transaction.currency,
                        status: transaction.status,
                        icon: transaction.icon,
                        color: transaction.color,
                        date: transaction.date
                    });
                    
                    if (result.success) {
                        const localTransactions = await this.getTransactions(userId);
                        localTransactions.unshift(result.data);
                        localStorage.setItem('sodmax_transactions', JSON.stringify(localTransactions));
                        
                        return result.data;
                    }
                    
                    return null;
                    
                } catch (error) {
                    console.error('خطا در ثبت تراکنش:', error);
                    return null;
                }
            }
            
            async getNotifications(userId) {
                try {
                    const localNotifications = localStorage.getItem('sodmax_notifications');
                    if (localNotifications) {
                        return JSON.parse(localNotifications);
                    }
                    
                    const notifications = await this.supabase.getNotifications(userId);
                    localStorage.setItem('sodmax_notifications', JSON.stringify(notifications));
                    return notifications;
                    
                } catch (error) {
                    console.error('خطا در دریافت نوتیفیکیشن‌ها:', error);
                    return [];
                }
            }
            
            async markNotificationAsRead(notificationId) {
                try {
                    const result = await this.supabase.markNotificationAsRead(notificationId);
                    if (result.success) {
                        const notifications = await this.getNotifications(this.currentUser.id);
                        const index = notifications.findIndex(n => n.id === notificationId);
                        if (index !== -1) {
                            notifications[index].read = true;
                            localStorage.setItem('sodmax_notifications', JSON.stringify(notifications));
                        }
                        return true;
                    }
                    return false;
                    
                } catch (error) {
                    console.error('خطا در بروزرسانی نوتیفیکیشن:', error);
                    return false;
                }
            }
            
            getUnreadNotificationsCount(userId) {
                const notifications = JSON.parse(localStorage.getItem('sodmax_notifications') || '[]');
                return notifications.filter(n => !n.read).length;
            }
            
            async getReferrals(userId) {
                try {
                    const localReferrals = localStorage.getItem('sodmax_referrals');
                    if (localReferrals) {
                        return JSON.parse(localReferrals);
                    }
                    
                    const referrals = await this.supabase.getReferrals(userId);
                    localStorage.setItem('sodmax_referrals', JSON.stringify(referrals));
                    return referrals;
                    
                } catch (error) {
                    console.error('خطا در دریافت دعوت‌ها:', error);
                    return null;
                }
            }
            
            async updateReferrals(userId, updatedReferrals) {
                try {
                    const result = await this.supabase.updateReferrals(updatedReferrals.id, {
                        totalInvites: updatedReferrals.total_invites,
                        activeInvites: updatedReferrals.active_invites,
                        pendingInvites: updatedReferrals.pending_invites,
                        totalEarned: updatedReferrals.total_earned
                    });
                    
                    if (result.success) {
                        localStorage.setItem('sodmax_referrals', JSON.stringify(result.data));
                        return true;
                    }
                    return false;
                    
                } catch (error) {
                    console.error('خطا در به‌روزرسانی دعوت‌ها:', error);
                    return false;
                }
            }
            
            async addReferral(userId) {
                try {
                    const referrals = await this.getReferrals(userId);
                    if (referrals) {
                        referrals.total_invites++;
                        referrals.pending_invites++;
                        
                        const result = await this.supabase.updateReferrals(referrals.id, {
                            totalInvites: referrals.total_invites,
                            activeInvites: referrals.active_invites,
                            pendingInvites: referrals.pending_invites,
                            totalEarned: referrals.total_earned
                        });
                        
                        if (result.success) {
                            const user = this.currentUser;
                            if (user) {
                                user.referralCount++;
                                await this.updateUser(user);
                            }
                            
                            localStorage.setItem('sodmax_referrals', JSON.stringify(result.data));
                            return result.data;
                        }
                    }
                    return null;
                    
                } catch (error) {
                    console.error('خطا در اضافه کردن دعوت:', error);
                    return null;
                }
            }
            
            async confirmReferral(userId) {
                try {
                    const referrals = await this.getReferrals(userId);
                    if (referrals && referrals.pending_invites > 0) {
                        referrals.pending_invites--;
                        referrals.active_invites++;
                        referrals.total_earned += 1000;
                        
                        const result = await this.supabase.updateReferrals(referrals.id, {
                            totalInvites: referrals.total_invites,
                            activeInvites: referrals.active_invites,
                            pendingInvites: referrals.pending_invites,
                            totalEarned: referrals.total_earned
                        });
                        
                        if (result.success) {
                            const user = this.currentUser;
                            if (user) {
                                user.referralEarnings += 1000;
                                user.tomanBalance += 1000;
                                user.totalEarned += 1000;
                                await this.updateUser(user);
                                
                                await this.addTransaction(userId, {
                                    type: "پاداش دعوت",
                                    amount: 1000,
                                    currency: "تومان",
                                    status: "موفق",
                                    icon: "fa-user-plus",
                                    color: "var(--secondary)"
                                });
                                
                                await this.supabase.createNotification({
                                    userId: userId,
                                    title: "🤝 دعوت موفق",
                                    message: "دوست شما ثبت‌نام و تأیید شد! +۱,۰۰۰ تومان پاداش",
                                    time: "همین حالا",
                                    read: false
                                });
                                
                                localStorage.setItem('sodmax_referrals', JSON.stringify(result.data));
                            }
                            
                            return result.data;
                        }
                    }
                    return null;
                    
                } catch (error) {
                    console.error('خطا در تأیید دعوت:', error);
                    return null;
                }
            }
            
            formatUserFromSupabase(supabaseUser) {
                return {
                    id: supabaseUser.id,
                    name: supabaseUser.name,
                    phone: supabaseUser.phone,
                    password: supabaseUser.password,
                    avatar: supabaseUser.avatar,
                    level: supabaseUser.level,
                    totalEarned: supabaseUser.total_earned,
                    referralCount: supabaseUser.referral_count,
                    referralEarnings: supabaseUser.referral_earnings,
                    joinDate: supabaseUser.join_date,
                    lastLogin: supabaseUser.last_login,
                    sodBalance: supabaseUser.sod_balance,
                    tomanBalance: supabaseUser.toman_balance,
                    miningPower: supabaseUser.mining_power,
                    miningMultiplier: supabaseUser.mining_multiplier,
                    autoMining: supabaseUser.auto_mining,
                    todayEarned: supabaseUser.today_earned,
                    totalMined: supabaseUser.total_mined,
                    completedMissions: supabaseUser.completed_missions,
                    referralCode: supabaseUser.referral_code,
                    referralLink: supabaseUser.referral_link
                };
            }
            
            formatUserToSupabase(user) {
                return {
                    name: user.name,
                    avatar: user.avatar,
                    level: user.level,
                    total_earned: user.totalEarned,
                    referral_count: user.referralCount,
                    referral_earnings: user.referralEarnings,
                    last_login: user.lastLogin,
                    sod_balance: user.sodBalance,
                    toman_balance: user.tomanBalance,
                    mining_power: user.miningPower,
                    mining_multiplier: user.miningMultiplier,
                    auto_mining: user.autoMining,
                    today_earned: user.todayEarned,
                    total_mined: user.totalMined,
                    completed_missions: user.completedMissions,
                    referral_code: user.referralCode,
                    referral_link: user.referralLink
                };
            }
        }

        // ==================== سیستم اصلی اپلیکیشن ====================
        class MobileCityVerse {
            constructor() {
                this.userManager = new UserManager();
                this.currentUser = null;
                this.autoMiningInterval = null;
                this.boostEndTime = null;
                this.boostInterval = null;
            }
            
            async mine(user) {
                if (!user) return 0;
                
                const baseEarn = user.miningPower || 5;
                const multiplier = user.miningMultiplier || 1;
                const earned = baseEarn * multiplier;
                
                user.sodBalance = (user.sodBalance || 0) + earned;
                user.todayEarned = (user.todayEarned || 0) + earned;
                user.totalMined = (user.totalMined || 0) + earned;
                
                await this.userManager.addTransaction(user.id, {
                    type: "استخراج دستی",
                    amount: earned,
                    currency: "SOD",
                    status: "موفق",
                    icon: "fa-hard-hat",
                    color: "var(--primary)"
                });
                
                await this.userManager.updateUser(user);
                this.currentUser = user;
                
                return earned;
            }
            
            async autoMine(user) {
                if (!user || !user.autoMining) return 0;
                
                const earned = await this.mine(user);
                return earned;
            }
            
            async toggleAutoMining(user) {
                if (!user) return false;
                
                user.autoMining = !user.autoMining;
                await this.userManager.updateUser(user);
                this.currentUser = user;
                
                if (user.autoMining) {
                    this.startAutoMining();
                } else {
                    this.stopAutoMining();
                }
                
                return user.autoMining;
            }
            
            startAutoMining() {
                if (this.autoMiningInterval) {
                    clearInterval(this.autoMiningInterval);
                }
                
                this.autoMiningInterval = setInterval(async () => {
                    if (this.currentUser && this.currentUser.autoMining) {
                        const earned = await this.autoMine(this.currentUser);
                        if (earned > 0) {
                            this.createMiningEffect(earned);
                            updateMobileUI();
                        }
                    } else {
                        this.stopAutoMining();
                    }
                }, 5000);
            }
            
            stopAutoMining() {
                if (this.autoMiningInterval) {
                    clearInterval(this.autoMiningInterval);
                    this.autoMiningInterval = null;
                }
            }
            
            async boostMining(user) {
                if (!user) return false;
                
                const cost = 5000;
                if (user.sodBalance < cost) {
                    return false;
                }
                
                user.sodBalance -= cost;
                user.miningMultiplier = 3;
                this.boostEndTime = Date.now() + 30000;
                
                await this.userManager.addTransaction(user.id, {
                    type: "خرید بوست",
                    amount: -cost,
                    currency: "SOD",
                    status: "موفق",
                    icon: "fa-bolt",
                    color: "var(--accent)"
                });
                
                await this.userManager.updateUser(user);
                this.currentUser = user;
                
                this.startBoostTimer();
                
                return true;
            }
            
            startBoostTimer() {
                if (this.boostInterval) {
                    clearInterval(this.boostInterval);
                }
                
                this.boostInterval = setInterval(() => {
                    if (this.boostEndTime && Date.now() >= this.boostEndTime) {
                        if (this.currentUser) {
                            this.currentUser.miningMultiplier = 1;
                            this.userManager.updateUser(this.currentUser);
                            updateMobileUI();
                        }
                        this.clearBoostTimer();
                    }
                }, 1000);
            }
            
            clearBoostTimer() {
                if (this.boostInterval) {
                    clearInterval(this.boostInterval);
                    this.boostInterval = null;
                    this.boostEndTime = null;
                }
            }
            
            async upgradeMiner(user) {
                if (!user) return false;
                
                const cost = 50000;
                if (user.sodBalance < cost) {
                    return false;
                }
                
                user.sodBalance -= cost;
                user.miningPower = (user.miningPower || 5) + 5;
                user.level = (user.level || 1) + 1;
                
                await this.userManager.addTransaction(user.id, {
                    type: "ارتقاء ماینر",
                    amount: -cost,
                    currency: "SOD",
                    status: "موفق",
                    icon: "fa-arrow-up",
                    color: "var(--accent)"
                });
                
                await this.userManager.updateUser(user);
                this.currentUser = user;
                
                await supabaseManager.createNotification({
                    userId: user.id,
                    title: "🎉 ارتقاء موفق",
                    message: `ماینر شما به سطح ${user.level} ارتقا یافت! قدرت +۵ افزایش یافت.`,
                    time: "همین حالا",
                    read: false
                });
                
                return true;
            }
            
            async withdrawToman(user) {
                if (!user) return false;
                
                if (user.tomanBalance < 10000) {
                    return false;
                }
                
                const amount = user.tomanBalance;
                user.tomanBalance = 0;
                
                await this.userManager.addTransaction(user.id, {
                    type: "برداشت تومان",
                    amount: amount,
                    currency: "تومان",
                    status: "در حال پردازش",
                    icon: "fa-download",
                    color: "var(--secondary)"
                });
                
                await this.userManager.updateUser(user);
                this.currentUser = user;
                
                return amount;
            }
            
            async inviteFriend(user) {
                if (!user) return false;
                
                const referrals = await this.userManager.addReferral(user.id);
                
                if (referrals) {
                    return true;
                }
                return false;
            }
            
            async confirmReferral(userId) {
                return await this.userManager.confirmReferral(userId);
            }
            
            formatNumber(num) {
                if (!num) return "0";
                if (num >= 1000000) return (num / 1000000).toFixed(2) + 'M';
                if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
                return num.toString();
            }
            
            getNextLevelCost(level) {
                return level * 10000;
            }
            
            getAvatarFromName(name) {
                return name ? name.charAt(0) : "ع";
            }
            
            createMiningEffect(amount) {
                const minerElement = document.querySelector('.miner-3d-mobile');
                if (!minerElement) return;
                
                const rect = minerElement.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                const effect = document.createElement('div');
                effect.className = 'mining-effect';
                effect.innerHTML = `<span>+${amount} SOD</span>`;
                
                effect.style.position = 'fixed';
                effect.style.left = `${centerX}px`;
                effect.style.top = `${centerY}px`;
                effect.style.zIndex = '10000';
                
                document.body.appendChild(effect);
                
                setTimeout(() => {
                    if (effect.parentNode) {
                        effect.parentNode.removeChild(effect);
                    }
                }, 1100);
            }
            
            playMiningSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    
                } catch (e) {
                    console.log('پخش صدا پشتیبانی نمی‌شود');
                }
            }
            
            vibrate(pattern) {
                if (navigator.vibrate) {
                    navigator.vibrate(pattern);
                }
            }
        }

        // ==================== رابط کاربری موبایل ====================
        const mobileClient = new MobileCityVerse();

        // راه‌اندازی
        async function initializeMobile() {
            const currentUser = mobileClient.userManager.getCurrentUser();
            
            if (currentUser) {
                mobileClient.currentUser = currentUser;
                showApp();
                updateMobileUI();
                
                if (currentUser.autoMining) {
                    mobileClient.startAutoMining();
                }
                
                console.log('📱 SODmAX CityVerse Mobile با Supabase راه‌اندازی شد!');
            } else {
                showAuth();
            }
            
            vibrateTest();
        }

        // نمایش اپلیکیشن
        function showApp() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('appContainer').classList.add('active');
        }

        // نمایش فرم احراز هویت
        function showAuth() {
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('appContainer').classList.remove('active');
            showRegisterForm();
        }

        // نمایش فرم ثبت‌نام
        function showRegisterForm() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }

        // نمایش فرم ورود
        function showLoginForm() {
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
        }

        // بروزرسانی UI
        async function updateMobileUI() {
            const user = mobileClient.currentUser;
            if (!user) return;
            
            document.getElementById('userAvatar').textContent = mobileClient.getAvatarFromName(user.name);
            document.getElementById('userNameDisplay').textContent = user.name;
            document.getElementById('userLevelDisplay').textContent = `آنلاین - سطح ${user.level}`;
            
            document.getElementById('quickSodBalance').textContent = mobileClient.formatNumber(user.sodBalance);
            document.getElementById('quickTomanBalance').textContent = mobileClient.formatNumber(user.tomanBalance);
            document.getElementById('quickReferralCount').textContent = user.referralCount;
            
            const earned = (user.miningPower || 5) * (user.miningMultiplier || 1);
            document.getElementById('clickRewardMobile').textContent = `+${earned} SOD`;
            document.getElementById('miningPowerMobile').textContent = `${earned}x`;
            document.getElementById('miningTodayMobile').textContent = mobileClient.formatNumber(user.todayEarned || 0);
            document.getElementById('miningTotalMobile').textContent = mobileClient.formatNumber(user.totalMined || 0);
            document.getElementById('miningTodayText').textContent = `+${(user.todayEarned || 0).toLocaleString('fa-IR')} SOD`;
            
            document.getElementById('minerLevel').textContent = user.level;
            const nextLevelCost = mobileClient.getNextLevelCost(user.level);
            document.getElementById('nextLevelCost').textContent = nextLevelCost.toLocaleString('fa-IR');
            document.getElementById('currentPower').textContent = `${user.miningPower || 5}x`;
            document.getElementById('nextPower').textContent = `${(user.miningPower || 5) + 5}x`;
            document.getElementById('upgradeCost').textContent = `${nextLevelCost.toLocaleString('fa-IR')} SOD`;
            document.getElementById('upgradeCostBtn').textContent = mobileClient.formatNumber(nextLevelCost);
            
            document.getElementById('walletSodBalance').textContent = (user.sodBalance || 0).toLocaleString('fa-IR');
            document.getElementById('walletTomanBalance').textContent = (user.tomanBalance || 0).toLocaleString('fa-IR');
            document.getElementById('modalSodBalance').textContent = `${(user.sodBalance || 0).toLocaleString('fa-IR')} SOD`;
            document.getElementById('modalTomanBalance').textContent = `${(user.tomanBalance || 0).toLocaleString('fa-IR')} تومان`;
            
            document.getElementById('menuSodBalance').textContent = mobileClient.formatNumber(user.sodBalance);
            document.getElementById('menuTomanBalance').textContent = mobileClient.formatNumber(user.tomanBalance);
            document.getElementById('menuTotalEarned').textContent = mobileClient.formatNumber(user.totalEarned);
            document.getElementById('inviteBadge').textContent = user.referralCount;
            
            document.getElementById('referralCountMobile').textContent = `${user.referralCount} دوست دعوت کرده‌اید`;
            document.getElementById('totalReferralEarningsMobile').textContent = mobileClient.formatNumber(user.referralEarnings);
            document.getElementById('referralLinkMobile').textContent = user.referralLink;
            document.getElementById('referralCodeMobile').textContent = user.referralCode;
            
            const referrals = await mobileClient.userManager.getReferrals(user.id);
            if (referrals) {
                document.getElementById('totalInvitesMobile').textContent = referrals.total_invites;
                document.getElementById('activeInvitesMobile').textContent = referrals.active_invites;
                document.getElementById('pendingInvitesMobile').textContent = referrals.pending_invites;
                document.getElementById('totalEarnedInvitesMobile').textContent = mobileClient.formatNumber(referrals.total_earned);
            }
            
            const mission1 = mobileClient.userManager.gameData.missions.active[0];
            if (mission1) {
                const progressPercent = (mission1.progress / mission1.max) * 100;
                document.getElementById('mission1Progress').style.width = `${progressPercent}%`;
                document.getElementById('mission1Text').textContent = `${mission1.progress}/${mission1.max}`;
            }
            
            const mission2 = mobileClient.userManager.gameData.missions.active[1];
            if (mission2) {
                const progressPercent = (mission2.progress / mission2.max) * 100;
                document.getElementById('mission2Progress').style.width = `${progressPercent}%`;
                document.getElementById('mission2Text').textContent = `${mission2.progress}/${mission2.max}`;
            }
            
            document.getElementById('profileAvatar').textContent = mobileClient.getAvatarFromName(user.name);
            document.getElementById('profileName').textContent = user.name;
            document.getElementById('profilePhone').innerHTML = `<i class="fas fa-phone"></i> ${user.phone}`;
            document.getElementById('profileLevel').textContent = user.level;
            document.getElementById('profileJoinDate').textContent = user.joinDate;
            document.getElementById('profileLastLogin').textContent = user.lastLogin;
            document.getElementById('profileReferrals').textContent = user.referralCount;
            document.getElementById('profileTotalEarned').textContent = mobileClient.formatNumber(user.totalEarned);
            document.getElementById('completedMissions').textContent = user.completedMissions || 0;
            
            document.getElementById('modalUserAvatar').textContent = mobileClient.getAvatarFromName(user.name);
            document.getElementById('modalUserName').textContent = user.name;
            document.getElementById('modalUserPhone').innerHTML = `<i class="fas fa-calendar-alt"></i> عضو از ${user.joinDate}`;
            document.getElementById('modalUserLevel').textContent = user.level;
            document.getElementById('modalUserTotalEarned').textContent = mobileClient.formatNumber(user.totalEarned);
            document.getElementById('modalUserReferrals').textContent = user.referralCount;
            document.getElementById('modalUserMissions').textContent = user.completedMissions || 0;
            
            updateTransactionHistory();
            updateNotifications();
            
            const unreadCount = mobileClient.userManager.getUnreadNotificationsCount(user.id);
            document.getElementById('notificationBadge').textContent = unreadCount > 0 ? unreadCount : '';
        }

        // به‌روزرسانی تاریخچه تراکنش‌ها
        async function updateTransactionHistory() {
            const user = mobileClient.currentUser;
            if (!user) return;
            
            const transactions = await mobileClient.userManager.getTransactions(user.id);
            const container = document.getElementById('transactionHistory');
            container.innerHTML = '';
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--text-tertiary);">
                        <i class="fas fa-history" style="font-size: 32px; margin-bottom: var(--space-md); display: block; opacity: 0.5;"></i>
                        <div style="font-size: 14px; margin-bottom: var(--space-xs);">هیچ تراکنشی ثبت نشده است</div>
                        <div style="font-size: 12px; opacity: 0.7;">پس از انجام تراکنش، تاریخچه اینجا نمایش داده می‌شود</div>
                    </div>
                `;
                return;
            }
            
            transactions.slice(0, 10).forEach(transaction => {
                const isNegative = transaction.amount < 0;
                const amountText = isNegative ? 
                    `-${Math.abs(transaction.amount).toLocaleString('fa-IR')}` : 
                    `+${transaction.amount.toLocaleString('fa-IR')}`;
                
                const amountColor = isNegative ? 'var(--accent)' : 
                    (transaction.currency === 'SOD' ? 'var(--primary)' : 'var(--secondary)');
                
                const iconClass = transaction.icon || 'fa-exchange-alt';
                
                const transactionEl = document.createElement('div');
                transactionEl.className = 'transaction-item';
                transactionEl.onclick = () => {
                    showToastMobile(transaction.type, 
                        `مبلغ: ${amountText} ${transaction.currency}<br>تاریخ: ${transaction.date}<br>وضعیت: ${transaction.status}`, 
                        'info'
                    );
                };
                
                transactionEl.innerHTML = `
                    <div class="transaction-icon" style="background: ${transaction.color}; color: white;">
                        <i class="fas ${iconClass}"></i>
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-title">${transaction.type}</div>
                        <div class="transaction-date">${transaction.date}</div>
                    </div>
                    <div class="transaction-amount" style="color: ${amountColor}">
                        ${amountText}<br>
                        <small style="font-size: 10px; font-weight: normal; opacity: 0.8;">${transaction.currency}</small>
                    </div>
                `;
                container.appendChild(transactionEl);
            });
        }

        // به‌روزرسانی نوتیفیکیشن‌ها
        async function updateNotifications() {
            const user = mobileClient.currentUser;
            if (!user) return;
            
            const notifications = await mobileClient.userManager.getNotifications(user.id);
            const container = document.getElementById('notificationsList');
            container.innerHTML = '';
            
            if (notifications.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-xl); color: var(--text-tertiary); font-size: 12px;">
                        <i class="fas fa-bell-slash" style="font-size: 24px; margin-bottom: var(--space-sm); display: block;"></i>
                        هیچ نوتیفیکیشنی وجود ندارد
                    </div>
                `;
                return;
            }
            
            notifications.forEach(notification => {
                const notificationEl = document.createElement('div');
                notificationEl.style.cssText = `
                    padding: var(--space-md); 
                    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                    background: ${notification.read ? 'transparent' : 'rgba(0, 102, 255, 0.05)'};
                    cursor: pointer;
                `;
                notificationEl.onclick = () => {
                    mobileClient.userManager.markNotificationAsRead(notification.id);
                    updateNotifications();
                    updateMobileUI();
                };
                notificationEl.innerHTML = `
                    <div style="font-size: 13px; font-weight: 800; color: var(--text-primary); margin-bottom: 4px;">
                        ${notification.title}
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">
                        ${notification.message}
                    </div>
                    <div style="font-size: 11px; color: var(--text-tertiary); margin-top: 6px;">
                        ${notification.time}
                    </div>
                `;
                container.appendChild(notificationEl);
            });
        }

        // نمایش توست
        function showToastMobile(title, message, type = 'info') {
            const container = document.getElementById('toastContainerMobile');
            const toast = document.createElement('div');
            toast.className = 'toast-mobile';
            
            let icon = 'fa-bell';
            let borderColor = 'var(--primary)';
            
            switch(type) {
                case 'success':
                    icon = 'fa-check-circle';
                    borderColor = 'var(--success)';
                    break;
                case 'error':
                    icon = 'fa-exclamation-circle';
                    borderColor = 'var(--error)';
                    break;
                case 'warning':
                    icon = 'fa-exclamation-triangle';
                    borderColor = 'var(--warning)';
                    break;
            }
            
            toast.style.borderLeftColor = borderColor;
            toast.innerHTML = `
                <div class="toast-icon-mobile" style="background: ${borderColor};">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-content-mobile">
                    <div class="toast-title-mobile">${title}</div>
                    <div class="toast-message-mobile">${message}</div>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-10px)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // نمایش سکشن
        function showSectionMobile(sectionId) {
            document.querySelectorAll('.content-section-mobile').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.bottom-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[href="#${sectionId}"]`).classList.add('active');
            
            document.querySelectorAll('.nav-item-mobile').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.nav-item-mobile[href="#${sectionId}"]`)?.classList.add('active');
            
            closeMenu();
            
            window.scrollTo(0, 0);
        }

        // مدیریت منو
        function toggleMenu() {
            document.getElementById('mobileMenu').classList.toggle('active');
        }

        function closeMenu() {
            document.getElementById('mobileMenu').classList.remove('active');
        }

        // مدیریت مودال
        function showModalMobile(modalId) {
            document.getElementById(modalId).classList.add('active');
            closeMenu();
        }

        function closeModalMobile(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ==================== عملکردهای احراز هویت ====================
        document.getElementById('registerFormElement').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value.trim();
            const phone = document.getElementById('registerPhone').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const referralCode = document.getElementById('registerReferralCode').value.trim() || null;
            
            let hasError = false;
            
            if (name.length < 2) {
                showError('nameError', 'نام باید حداقل ۲ کاراکتر باشد');
                hasError = true;
            } else {
                hideError('nameError');
            }
            
            const phoneRegex = /^09[0-9]{9}$/;
            if (!phoneRegex.test(phone)) {
                showError('phoneError', 'شماره موبایل معتبر وارد کنید (مثال: 09123456789)');
                hasError = true;
            } else {
                hideError('phoneError');
            }
            
            if (password.length < 6) {
                showError('passwordError', 'رمز عبور باید حداقل ۶ کاراکتر باشد');
                hasError = true;
            } else {
                hideError('passwordError');
            }
            
            if (password !== confirmPassword) {
                showError('confirmPasswordError', 'رمز عبور با تکرار آن مطابقت ندارد');
                hasError = true;
            } else {
                hideError('confirmPasswordError');
            }
            
            if (hasError) return;
            
            const registerBtn = document.getElementById('registerBtn');
            registerBtn.disabled = true;
            registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال ثبت‌نام...';
            
            setTimeout(async () => {
                const result = await mobileClient.userManager.register(name, phone, password, referralCode);
                
                if (result.success) {
                    const message = referralCode ? 
                        `حساب کاربری شما با موفقیت ایجاد شد! ${result.referralBonus} SOD پاداش دعوت دریافت کردید.` :
                        'حساب کاربری شما با موفقیت ایجاد شد!';
                    
                    showToastMobile('✅ ثبت‌نام موفق', message, 'success');
                    
                    mobileClient.currentUser = result.user;
                    localStorage.setItem('sodmax_current_user', JSON.stringify(result.user));
                    
                    setTimeout(() => {
                        showApp();
                        updateMobileUI();
                        showSectionMobile('dashboard');
                    }, 1500);
                } else {
                    showError('phoneError', result.message);
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = '<i class="fas fa-user-plus"></i> ایجاد حساب کاربری';
                }
            }, 1500);
        });

        document.getElementById('loginFormElement').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            let hasError = false;
            
            if (phone.length === 0) {
                showError('loginPhoneError', 'شماره موبایل خود را وارد کنید');
                hasError = true;
            } else {
                hideError('loginPhoneError');
            }
            
            if (password.length === 0) {
                showError('loginPasswordError', 'رمز عبور خود را وارد کنید');
                hasError = true;
            } else {
                hideError('loginPasswordError');
            }
            
            if (hasError) return;
            
            const loginBtn = document.getElementById('loginBtn');
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> در حال ورود...';
            
            setTimeout(async () => {
                const result = await mobileClient.userManager.login(phone, password);
                
                if (result.success) {
                    showToastMobile('✅ ورود موفق', `خوش آمدید ${result.user.name}!`, 'success');
                    
                    mobileClient.currentUser = result.user;
                    
                    setTimeout(() => {
                        showApp();
                        updateMobileUI();
                        showSectionMobile('dashboard');
                    }, 1500);
                } else {
                    showError('loginPhoneError', result.message);
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ورود به حساب';
                }
            }, 1500);
        });

        document.getElementById('toggleRegisterPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('registerPassword');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        document.getElementById('toggleRegisterConfirmPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('registerConfirmPassword');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        document.getElementById('toggleLoginPassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('loginPassword');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        });

        document.getElementById('showLoginBtn').addEventListener('click', showLoginForm);
        document.getElementById('showRegisterBtn').addEventListener('click', showRegisterForm);
        document.getElementById('forgotPasswordBtn').addEventListener('click', function() {
            showToastMobile('🔐 بازیابی رمز عبور', 'این قابلیت به زودی فعال خواهد شد!', 'info');
        });

        // ==================== عملکردهای اصلی اپلیکیشن ====================
        async function manualMineMobile() {
            if (!mobileClient.currentUser) {
                showToastMobile('⚠️ خطا', 'لطفاً ابتدا وارد شوید', 'error');
                return;
            }
            
            const earned = await mobileClient.mine(mobileClient.currentUser);
            
            const soundToggle = document.getElementById('soundToggle');
            if (soundToggle && soundToggle.checked) {
                mobileClient.playMiningSound();
            }
            
            const vibrationToggle = document.getElementById('vibrationToggle');
            if (vibrationToggle && vibrationToggle.checked && navigator.vibrate) {
                mobileClient.vibrate([50, 30, 50]);
            }
            
            mobileClient.createMiningEffect(earned);
            
            updateMobileUI();
            
            showToastMobile('⚡ استخراج موفق', `+${earned} SOD دریافت کردید!`, 'success');
        }

        async function toggleAutoMiningMobile() {
            if (!mobileClient.currentUser) return;
            
            const isAutoMining = await mobileClient.toggleAutoMining(mobileClient.currentUser);
            
            showToastMobile(
                isAutoMining ? '🤖 استخراج خودکار' : '⏹️ استخراج دستی',
                isAutoMining ? 'استخراج خودکار فعال شد!' : 'استخراج خودکار متوقف شد',
                'info'
            );
            
            updateMobileUI();
        }

        async function boostMiningMobile() {
            if (!mobileClient.currentUser) return;
            
            if (await mobileClient.boostMining(mobileClient.currentUser)) {
                updateMobileUI();
                showToastMobile('⚡ افزایش قدرت', 'قدرت استخراج شما ۳ برابر شد! (۳۰ ثانیه)', 'success');
            } else {
                showToastMobile('⚠️ خطا', 'موجودی SOD کافی نیست!', 'error');
            }
        }

        async function upgradeMinerMobile() {
            if (!mobileClient.currentUser) return;
            
            if (await mobileClient.upgradeMiner(mobileClient.currentUser)) {
                updateMobileUI();
                showToastMobile('🆙 ارتقاء موفق', 'قدرت ماینر +۵ افزایش یافت!', 'success');
            } else {
                showToastMobile('⚠️ خطا', 'موجودی SOD کافی نیست!', 'error');
            }
        }

        async function completeMissionMobile(missionId) {
            if (!mobileClient.currentUser) return;
            
            // این تابع در نسخه فعلی ساده شده است
            showToastMobile('✅ مأموریت', 'مأموریت تکمیل شد!', 'success');
        }

        async function claimRewardMobile(type) {
            if (!mobileClient.currentUser) return;
            
            const user = mobileClient.currentUser;
            const rewards = {
                sod: { amount: 10000, message: '۱۰,۰۰۰ SOD دریافت کردید!' },
                toman: { amount: 5000, message: '۵,۰۰۰ تومان دریافت کردید!' },
                boost: { amount: 3, message: 'افزایش قدرت ۳x فعال شد!' },
                premium: { amount: 7, message: '۷ روز اشتراک Pro دریافت کردید!' }
            };
            
            const reward = rewards[type];
            if (reward) {
                if (type === 'sod') {
                    user.sodBalance += reward.amount;
                    await mobileClient.userManager.addTransaction(user.id, {
                        type: "پاداش SOD",
                        amount: reward.amount,
                        currency: "SOD",
                        status: "موفق",
                        icon: "fa-gift",
                        color: "var(--primary)"
                    });
                }
                if (type === 'toman') {
                    user.tomanBalance += reward.amount;
                    await mobileClient.userManager.addTransaction(user.id, {
                        type: "پاداش تومان",
                        amount: reward.amount,
                        currency: "تومان",
                        status: "موفق",
                        icon: "fa-gift",
                        color: "var(--secondary)"
                    });
                }
                if (type === 'boost') {
                    user.miningMultiplier = Math.max(user.miningMultiplier, 3);
                    mobileClient.boostEndTime = Date.now() + 30000;
                    mobileClient.startBoostTimer();
                }
                
                await mobileClient.userManager.updateUser(user);
                updateMobileUI();
                showToastMobile('🎁 پاداش دریافت شد', reward.message, 'success');
            }
        }

        async function claimAllRewardsMobile() {
            if (!mobileClient.currentUser) return;
            
            const user = mobileClient.currentUser;
            user.sodBalance += 10000;
            user.tomanBalance += 5000;
            user.miningMultiplier = Math.max(user.miningMultiplier, 3);
            
            await mobileClient.userManager.addTransaction(user.id, {
                type: "دریافت همه پاداش‌ها",
                amount: 10000,
                currency: "SOD",
                status: "موفق",
                icon: "fa-gift",
                color: "var(--primary)"
            });
            
            await mobileClient.userManager.addTransaction(user.id, {
                type: "دریافت همه پاداش‌ها",
                amount: 5000,
                currency: "تومان",
                status: "موفق",
                icon: "fa-gift",
                color: "var(--secondary)"
            });
            
            mobileClient.boostEndTime = Date.now() + 30000;
            mobileClient.startBoostTimer();
            
            await mobileClient.userManager.updateUser(user);
            updateMobileUI();
            showToastMobile('🎁 همه پاداش‌ها', 'تمام پاداش‌ها دریافت شدند!', 'success');
        }

        async function claimDailyReward() {
            if (!mobileClient.currentUser) return;
            
            const user = mobileClient.currentUser;
            const reward = 1000;
            user.tomanBalance += reward;
            user.totalEarned += reward;
            
            await mobileClient.userManager.addTransaction(user.id, {
                type: "پاداش روزانه",
                amount: reward,
                currency: "تومان",
                status: "موفق",
                icon: "fa-calendar-alt",
                color: "var(--secondary)"
            });
            
            await mobileClient.userManager.updateUser(user);
            updateMobileUI();
            showToastMobile('📅 پاداش روزانه', `+${reward.toLocaleString('fa-IR')} تومان دریافت کردید!`, 'success');
        }

        async function withdrawTomanMobile() {
            if (!mobileClient.currentUser) return;
            
            const amount = await mobileClient.withdrawToman(mobileClient.currentUser);
            if (amount) {
                updateMobileUI();
                showToastMobile('✅ درخواست ثبت شد', 
                    `${mobileClient.formatNumber(amount)} تومان برداشت شما ثبت شد.\nطی ۲۴ ساعت کاری واریز خواهد شد.`,
                    'success'
                );
                closeModalMobile('walletModal');
            } else {
                showToastMobile('⚠️ خطا', 'حداقل مبلغ برداشت ۱۰,۰۰۰ تومان است', 'error');
            }
        }

        function buySodMobile() {
            showToastMobile('🛒 خرید SOD', 'صفحه خرید به زودی فعال خواهد شد!', 'info');
        }

        function convertCurrencyMobile() {
            showToastMobile('💰 تبدیل ارز', 'سیستم تبدیل ارز به زودی فعال خواهد شد!', 'info');
        }

        function showAllMissionsMobile() {
            showSectionMobile('missions');
            showToastMobile('📋 همه مأموریت‌ها', 'لیست کامل مأموریت‌ها نمایش داده شد', 'info');
        }

        function showMiningStatsMobile() {
            showSectionMobile('mining');
        }

        function showNotificationsMobile() {
            showModalMobile('notificationModal');
        }

        function startChatSupport() {
            showToastMobile('💬 پشتیبانی', 'اتصال به اپراتور...', 'info');
        }

        function editProfileMobile() {
            showToastMobile('👤 ویرایش پروفایل', 'صفحه ویرایش پروفایل به زودی فعال خواهد شد!', 'info');
        }

        function changePasswordMobile() {
            showToastMobile('🔐 تغییر رمز عبور', 'صفحه تغییر رمز عبور به زودی فعال خواهد شد!', 'info');
        }

        function languageSettingsMobile() {
            showToastMobile('🌐 زبان و منطقه', 'تنظیمات زبان به زودی فعال خواهد شد!', 'info');
        }

        async function logoutMobile() {
            if (confirm('آیا از خروج از حساب کاربری خود مطمئن هستید؟')) {
                showToastMobile('👋 خروج از حساب', 'در حال خروج...', 'info');
                
                setTimeout(() => {
                    mobileClient.stopAutoMining();
                    mobileClient.clearBoostTimer();
                    
                    mobileClient.userManager.logout();
                    mobileClient.currentUser = null;
                    
                    showAuth();
                    showToastMobile('✅ خارج شدید', 'با موفقیت از حساب کاربری خارج شدید', 'success');
                }, 1500);
            }
        }

        // ==================== عملکردهای دعوت دوستان ====================
        function copyReferralLink() {
            const user = mobileClient.currentUser;
            if (!user) return;
            
            const link = user.referralLink;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(link).then(() => {
                    showToastMobile('📋 کپی شد', 'لینک دعوت با موفقیت کپی شد!', 'success');
                }).catch(err => {
                    fallbackCopyToClipboard(link);
                });
            } else {
                fallbackCopyToClipboard(link);
            }
        }

        function copyReferralCode() {
            const user = mobileClient.currentUser;
            if (!user) return;
            
            const code = user.referralCode;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(code).then(() => {
                    showToastMobile('📋 کپی شد', 'کد دعوت با موفقیت کپی شد!', 'success');
                }).catch(err => {
                    fallbackCopyToClipboard(code);
                });
            } else {
                fallbackCopyToClipboard(code);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showToastMobile('📋 کپی شد', 'محتوا با موفقیت کپی شد!', 'success');
            } catch (err) {
                showToastMobile('⚠️ خطا', 'کپی کردن با مشکل مواجه شد', 'error');
            }
            
            document.body.removeChild(textArea);
        }

        function shareViaWhatsApp() {
            const user = mobileClient.currentUser;
            if (!user) return;
            
            const message = `به SODmAX CityVerse بپیوندید! 🌟\n\nبا استفاده از لینک زیر ثبت‌نام کنید و ۱۰۰۰ SOD هدیه دریافت کنید:\n${user.referralLink}\n\nکد دعوت: ${user.referralCode}`;
            const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
            
            window.open(url, '_blank');
            showToastMobile('📱 اشتراک‌گذاری', 'در حال بازکردن واتساپ...', 'info');
        }

        function shareViaTelegram() {
            const user = mobileClient.currentUser;
            if (!user) return;
            
            const message = `به SODmAX CityVerse بپیوندید! 🌟\n\nبا استفاده از لینک زیر ثبت‌نام کنید و ۱۰۰۰ SOD هدیه دریافت کنید:\n${user.referralLink}\n\nکد دعوت: ${user.referralCode}`;
            const url = `https://t.me/share/url?url=${encodeURIComponent(user.referralLink)}&text=${encodeURIComponent(message)}`;
            
            window.open(url, '_blank');
            showToastMobile('📱 اشتراک‌گذاری', 'در حال بازکردن تلگرام...', 'info');
        }

        function shareViaInstagram() {
            showToastMobile('📱 اینستاگرام', 'اشتراک‌گذاری در اینستاگرام به زودی فعال خواهد شد!', 'info');
        }

        async function inviteFriendMobile() {
            if (!mobileClient.currentUser) return;
            
            if (await mobileClient.inviteFriend(mobileClient.currentUser)) {
                updateMobileUI();
                showToastMobile('🤝 دعوت ارسال شد', 'دعوت شما ثبت شد. بعد از تأیید دوستتان، ۱,۰۰۰ تومان پاداش دریافت خواهید کرد!', 'info');
                
                setTimeout(async () => {
                    await mobileClient.confirmReferral(mobileClient.currentUser.id);
                    updateMobileUI();
                    showToastMobile('🤝 دعوت تأیید شد', 'دوست شما ثبت‌نام و تأیید شد! +۱,۰۰۰ تومان پاداش دریافت کردید.', 'success');
                }, 3000);
            }
        }

        // ==================== ابزارها ====================
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.querySelector('i').nextSibling.textContent = message;
            errorElement.classList.add('show');
            
            const inputId = elementId.replace('Error', '');
            const inputElement = document.getElementById(inputId);
            if (inputElement) {
                inputElement.classList.add('error');
            }
        }

        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.classList.remove('show');
            
            const inputId = elementId.replace('Error', '');
            const inputElement = document.getElementById(inputId);
            if (inputElement) {
                inputElement.classList.remove('error');
            }
        }

        function vibrateTest() {
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
        }

        // ==================== رویدادها ====================
        document.addEventListener('DOMContentLoaded', initializeMobile);

        document.addEventListener('click', function(event) {
            const menu = document.getElementById('mobileMenu');
            const menuBtn = document.querySelector('.header-btn:nth-child(2)');
            
            if (menu.classList.contains('active') && 
                !menu.contains(event.target) && 
                !menuBtn.contains(event.target)) {
                closeMenu();
            }
        });

        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-mobile-overlay')) {
                event.target.classList.remove('active');
            }
        });

        document.addEventListener('touchmove', function(event) {
            if (document.getElementById('mobileMenu').classList.contains('active') || 
                document.querySelector('.modal-mobile-overlay.active')) {
                event.preventDefault();
            }
        }, { passive: false });

        document.getElementById('darkModeToggle').addEventListener('change', function(e) {
            showToastMobile('🌙 حالت شب', this.checked ? 'فعال شد' : 'غیرفعال شد', 'info');
        });
        
        document.getElementById('notificationsToggle').addEventListener('change', function(e) {
            showToastMobile('🔔 اعلان‌ها', this.checked ? 'فعال شد' : 'غیرفعال شد', 'info');
        });
        
        document.getElementById('soundToggle').addEventListener('change', function(e) {
            showToastMobile('🔊 صدا', this.checked ? 'فعال شد' : 'غیرفعال شد', 'info');
        });
        
        document.getElementById('vibrationToggle').addEventListener('change', function(e) {
            showToastMobile('📳 ویبره', this.checked ? 'فعال شد' : 'غیرفعال شد', 'info');
        });

        window.addEventListener('beforeunload', function() {
            mobileClient.stopAutoMining();
            mobileClient.clearBoostTimer();
        });
    </script>
</body>
</html>
